!function(){class e{constructor(t,e,i,a){this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=a,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.PAGE_3=3*this.PAGESIZE,this.PAGE_4=4*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=22,this.cursorColor2=64,this.stencil=!1,this.stencilSource=this.PAGE_2,this.stencilOffset=0,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.zbuf=new Float64Array(this.WIDTH*this.HEIGHT)}setPen(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i}clr(t,e){this.ram.fill(t,e,e+this.PAGESIZE),this.zbuf.fill(9999999999,0,this.WIDTH*this.HEIGHT)}pset(t,e,i,a=0){if(0>t|t>this.WIDTH-1)return;if(0>e|e>this.HEIGHT-1)return;if(a>this.zbuf[e*this.WIDTH+t])return;let s=this.pat&Math.pow(2,(e|=0)%4*4+(t|=0)%4)?i:this.cursorColor2;64!=s&&(this.ram[this.renderTarget+e*this.WIDTH+t]=s,this.zbuf[e*this.WIDTH+t]=a)}pget(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]}span(t,e,i,a,s){t|=0,e|=0,a|=0;for(let r=0;i>r;r++)this.pset(t+r,e,a,s)}span2(t,e,i,a,s,r){e|=0,a|=0,s|=0;let n=Math.abs((i|=0)-(t|=0))+1,o=i>t?t:i,h=a>e?e:a;for(let t=0;n>t;t++)this.pset(o+t,h,s,r)}line(t,e,i,a,s,r=0){var n,o,h=(a|=0)-(e|=0),l=(i|=0)-(t|=0);if(0>h?(h=-h,o=-1):o=1,0>l?(l=-l,n=-1):n=1,h<<=1,l<<=1,this.pset(t,e,s,r),l>h)for(var c=h-(l>>1);t!=i;)0>c||(e+=o,c-=l),c+=h,this.pset(t+=n,e,s,r);else for(c=l-(h>>1);e!=a;)0>c||(t+=n,c-=h),c+=l,this.pset(t,e+=o,s,r)}line3d(t,e,i,a,s,r,n){var o,h,l,c=(s|=0)-(e|=0),d=(a|=0)-(t|=0),p=r-i,u=[];if(0>c?(c=-c,h=-1):h=1,0>d?(d=-d,o=-1):o=1,c<<=1,d<<=1,this.pset(t,e,n,i),d>c)for(var m=c-(d>>1);t!=a;)0>m||(e+=h,m-=d),m+=c,u.push({x:t+=o,y:e});else for(m=d-(c>>1);e!=s;)0>m||(t+=o,m-=c),m+=d,u.push({x:t,y:e+=h});l=p/u.length;for(let t=0;u.length>t;t++)this.pset(u[t].x,u[t].y,n,l*t+i)}tline(t,e,i,a,s=0,r=0,n=0,o=0){var h,l,c=(a|=0)-(e|=0),d=(i|=0)-(t|=0);0>c?(c=-c,l=-1):l=1,0>d?(d=-d,h=-1):h=1;for(var p=t,u=e,m=(c<<=1)-((d<<=1)>>1);p!=i;)0>m||(u+=l,m-=d),m+=c,this.pset(p+=h,u,this.pget(p-s,u-r,this.renderSource)+n)}circle(t,e,i,a,s=0){t|=0,e|=0,a|=0;for(let r=-(i|=0);i>=r;r++)for(let n=-i;i>=n;n++)i*i-i>n*n+r*r||n*n+r*r>i*i+i||this.pset(t+n,e+r,a,s)}fillCircle(t,e,i,a,s=0){t|=0,e|=0,a|=0;for(let r=-(i|=0);i>=r;r++)for(let n=-i;i>=n;n++)n*n+r*r>i*i||this.pset(t+n,e+r,a,s)}tfillCircle(t,e,i,a=0,s=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var r=-(i|=0),n=0,o=2-2*i;do{this.tline(t-r,e-n,t+r,e-n,offX,offY,a,s),this.tline(t-r,e+n,t+r,e+n,offX,offY,a,s),(i=o)>n||(o+=2*++n+1),(i>r||o>n)&&(o+=2*++r+1)}while(0>r)}}rect(t,e,i,a,s,r=0){let n=0|t,o=0|e,h=t+i|0,l=e+a|0;this.line(n,o,h,o,s,r),this.line(h,o,h,l,s,r),this.line(n,l,h,l,s,r),this.line(n,o,n,l,s,r)}fillRect(t,e,i,a,s,r=0){let n=0|t,o=0|e,h=0|i,l=(e+a|0)-1;s=s;var c=Math.abs(l-o);if(this.span(n,o,h,s,r),c>0)for(;--c;)this.span(n,o+c,h,s,r);this.span(n,l,h,s,r)}sspr(t=0,e=0,i=16,a=16,s=0,r=0,n=32,o=32,h=!1,l=!1,c=0){var d=i/n,p=a/o;this.pat=this.dither[0];for(var u=0;o>u;u++)for(var m=0;n>m;m++)px=m*d|0,py=u*p|0,e=l?a-py-u:e,t=h?i-px-m:t,source=this.pget(t+px,e+py,this.renderSource),source>0&&this.pset(s+m,r+u,source)}outline(t,e,i,a,s,r){for(let t=0;this.WIDTH>=t;t++)for(let e=0;this.HEIGHT>=e;e++){let n=t-1+e*this.WIDTH,o=t+1+e*this.WIDTH,h=t+(e+1)*this.WIDTH,l=t+(e-1)*this.WIDTH;this.ram[this.renderSource+(t+e*this.WIDTH)]&&(64==this.ram[this.renderSource+n]&&(this.ram[this.renderTarget+n]=i),64==this.ram[this.renderSource+o]&&(this.ram[this.renderTarget+o]=s),64==this.ram[this.renderSource+l]&&(this.ram[this.renderTarget+l]=a),64==this.ram[this.renderSource+h]&&(this.ram[this.renderTarget+h]=r))}}triangle(t,e,i,a,s=0){this.line(t.x,t.y,e.x,e.y,a),this.line(e.x,e.y,i.x,i.y,a),this.line(i.x,i.y,t.x,t.y,a)}strokePolygon(t,e,i,a,s=0,r="white"){a=a||Math.floor(240*i)+16;for(let n=0;a>n;n++){let o=n/a*6.283185,h=(n+1)/a*6.283185;this.line(t+Math.cos(o+s)*i,e+Math.sin(o+s)*i,t+Math.cos(h+s)*i,e+Math.sin(h+s)*i,r)}}fillTriangle(t,e,i,a,s){let r=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),n=r[0],o=r[1],h=r[2],l=0,c=0,d=0,p={},u={};if(o.y-n.y>0&&(l=(o.x-n.x)/(o.y-n.y)),h.y-n.y>0&&(c=(h.x-n.x)/(h.y-n.y)),h.y-o.y>0&&(d=(h.x-o.x)/(h.y-o.y)),Object.assign(p,n),Object.assign(u,n),l>c){for(;o.y>=p.y;p.y++,u.y++,p.x+=c,u.x+=l)this.span2(p.x,p.y,u.x,p.y,a,s);for(u=o;h.y>=p.y;p.y++,u.y++,p.x+=c,u.x+=d)this.span2(p.x,p.y,u.x,p.y,a,s)}else{for(;o.y>=p.y;p.y++,u.y++,p.x+=l,u.x+=c)this.span2(p.x,p.y,u.x,p.y,a,s);for(p=o;h.y>=p.y;p.y++,u.y++,p.x+=d,u.x+=c)this.span2(p.x,p.y,u.x,p.y,a,s)}}imageToRam(t,e){let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let a=i.getContext("2d");a.drawImage(t,0,0);var s=a.getImageData(0,0,WIDTH,HEIGHT);let r=new Uint32Array(s.data.buffer),n=0;for(len=r.length;n<len;)ram[e+n]=colors.indexOf(r[n]),n++}render(){let t=0,e=this.PAGESIZE;for(;e>t;)this.data[t]=this.colors[this.pal[this.ram[t]]],t++;this.imageData.data.set(this.buf8),this.c.width=this.c.width,this.ctx.putImageData(this.imageData,0,0)}textLine(t){let e=t[0].length;for(var i=0;e>i;i++){let e=this.getCharacter(t[0].charAt(i));for(var a=0;5>a;a++)for(var s=0;5>s;s++)1==e[5*a+s]&&(1==t[4]?this.pset(t[1]+s*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[5]):this.fillRect(t[1]+s*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[4],t[4],t[5]))}}text(t){let e=5*t[7],i=t[0].split("\n"),a=i.slice(0),s=i.length,r=a.sort((t,e)=>e.length-t.length)[0],n=r.length*e+(r.length-1)*t[3],o=s*e+(s-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var h=t[1],l=t[2],c=t[1]+n,d=t[2]+o;"center"==t[5]?(h=t[1]-n/2,c=t[1]+n/2):"right"==t[5]&&(h=t[1]-n,c=t[1]),"center"==t[6]?(l=t[2]-o/2,d=t[2]+o/2):"bottom"==t[6]&&(l=t[2]-o,d=t[2]);for(var p=h+n/2,u=l+o/2,m=0;s>m;m++){let a=i[m],s=a.length*e+(a.length-1)*t[3],r=t[1],n=t[2]+(e+t[4])*m;"center"==t[5]?r=t[1]-s/2:"right"==t[5]&&(r=t[1]-s),"center"==t[6]?n-=o/2:"bottom"==t[6]&&(n-=o),this.textLine([a,r,n,t[3],t[7],t[8]])}return{sx:h,sy:l,cx:p,cy:u,ex:c,ey:d,width:n,height:o}}getCharacter(t){let e=this.fontString.indexOf(t);return this.fontBitmap.substring(25*e,25*e+25).split("")}}var i=function(){var t,e,i,a,s,r=t=>Math.sin(6.283184*t),n=t=>.003959503758*2**((t-128)/12),o=(t,e,i)=>{var a,s,r,o,l,c,d=h[t.i[0]],p=t.i[1],u=t.i[3]/32,m=h[t.i[4]],y=t.i[5],f=t.i[8]/32,w=t.i[9],x=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,E=1/v,D=-t.i[13]/16,T=t.i[14],I=i*2**(2-t.i[15]),A=new Int32Array(x+g+v),C=0,b=0;for(a=0,s=0;x+g+v>a;a++,s++)0>s||(s-=I,l=n(e+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),c=n(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,x>a?r=a/x:x+g>a||(r=(1-(r=(a-x-g)*E))*3**(D*r)),o=d(C+=l*r**u)*p,o+=m(b+=c*r**f)*y,w&&(o+=(2*Math.random()-1)*w),A[a]=80*o*r|0;return A},h=[r,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=r=>{t=r,i=0,a=r.rowLen*r.patternLen*((e=r.endPattern)+1)*2,s=new Int32Array(a)},this.generate=()=>{var n,l,c,d,p,u,m,y,f,w,x,g,v,E,D=new Int32Array(a),T=t.songData[i],I=t.rowLen,A=t.patternLen,C=0,b=0,S=!1,H=[];for(c=0;e>=c;++c)for(m=T.p[c],d=0;A>d;++d){var z=m?T.c[m-1].f[d]:0;z&&(T.i[z-1]=T.c[m-1].f[d+A]||0,17>z&&(H=[]));var M=h[T.i[16]],P=T.i[17]/512,G=2**(T.i[18]-9)/I,L=T.i[19],R=T.i[20],W=135.82764118168*T.i[21]/44100,k=1-T.i[22]/255,O=1e-5*T.i[23],N=T.i[24]/32,Z=T.i[25]/512,U=6.283184*2**(T.i[26]-9)/I,X=T.i[27]/255,B=T.i[28]*I&-2;for(x=(c*A+d)*I,p=0;4>p;++p)if(u=m?T.c[m-1].n[d+p*A]:0){H[u]||(H[u]=o(T,u,I));var V=H[u];for(l=0,n=2*x;V.length>l;l++,n+=2)D[n]+=V[l]}for(l=0;I>l;l++)(w=D[y=2*(x+l)])||S?(g=W,L&&(g*=M(G*y)*P+.5),b+=(g=1.5*Math.sin(g))*(v=k*(w-b)-(C+=g*b)),w=3==R?b:1==R?v:C,O&&(w=1>(w*=O)?w>-1?r(.25*w):-1:1,w/=O),S=(w*=N)*w>1e-5,E=w*(1-(f=Math.sin(U*y)*Z+.5)),w*=f):E=0,B>y||(E+=D[y-B+1]*X,w+=D[y-B]*X),D[y]=0|E,D[y+1]=0|w,s[y]+=0|E,s[y+1]+=0|w}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,a/2,44100),i=0;2>i;i++)for(var r=e.getChannelData(i),n=i;a>n;n+=2)r[n>>1]=s[n]/65536;return e},this.createWave=()=>{var t=44+2*a-8,e=t-36,i=new Uint8Array(44+2*a);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,n=44;a>r;++r){var o=s[r];i[n++]=255&(o=-32767>o?-32767:o>32767?32767:o),i[n++]=o>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),a=Array(e),r=0;2*e>r;r+=1){var n=i+r;a[r]=t>0&&s.length>n?s[n]/32768:0}return a}};function a(t,e){return Math.floor(Math.random()*(e+1-t)+t)}function s(t){return t[a(0,t.length-1)]}function n(t,e=0){return t.x-view.x+e>0&&t.y-view.y+e>0&&t.x-view.x-e<w&&t.y-view.y-e<h}function o(t,e=1,i=0,a=.5,s=!1){var r=window.audioCtx.createBufferSource(),n=window.audioCtx.createGain(),o=window.audioCtx.createStereoPanner();return r.buffer=t,r.connect(o),o.connect(n),n.connect(audioMaster),r.playbackRate.value=e,r.loop=s,n.gain.value=a,o.pan.value=i,r.start(),{volume:n,sound:r}}const l={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,q:81,r:82,m:77,h:72,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}},c=(t,e,i)=>Math.min(Math.max(t,e),i);function d(t,e,i,a){var{cos:s,sin:r}=Math,n=s(e),o=r(e),h=s(a),l=r(a),c=s(-i),d=r(-i);return{x:n*h*t.x+(n*l*d-o*c)*t.y+(n*l*c+o*d)*t.z,y:o*h*t.x+(o*l*d+n*c)*t.y+(o*l*c-n*d)*t.z,z:-l*t.x+h*d*t.y+h*c*t.z}}function p(t,e,i,a){var s,r,{cos:n,sin:o,sqrt:h,atan2:l}=Math;e-=a.camY,s=l(t-=a.camX,i-=a.camZ),r=h(t*t+i*i),t=o(s-a.yaw)*r,s=l(e,i=n(s-a.yaw)*r),r=h(e*e+i*i),e=o(s-a.pitch)*r;var c=200*((i=n(s-a.pitch)*r)-0)-0*(t-0),d=(1*(t-0)- -100*(i-0))/c,p=200/c;return d>0&&1>d&&p>0&&1>p?{x:a.cx+(200*d-100)*a.scale,y:a.cy+e/i*a.scale,d:h(t*t+e*e+i*i)}:{d:-1}}function u(t,e,i){this.x=t,this.y=e,this.z=i}const m={CIRCLE:0,SQUARE:1,POINT:2,TRIANGLES:3,SPRITE:4};class f{constructor(t,e,i,a={fill:{color1:22,color2:0,pattern:r.dither[0]},shape:m.point,size:1,angle:0,triangles:[]}){this.vert=new u(t,e,i),this.size=a.size,this.shape=a.shape,this.fill=a.fill,this.triangles=a.triangles,this.angle=a.angle}draw(t){let e=p(this.vert.x,this.vert.y,this.vert.z,t);if(-1!=e.d&&500>e.d&&n(e,100)){let{x:i,y:a}=e,s=this.size,o=this.shape,h=this.fill,{color1:l,color2:c,pattern:u}=h,m=s*(40/e.d);if(1>m&&3!=o)return;switch(r.cursorColor2=c,r.pat=u,o){case 0:1>m?r.pset(i,a,this.fill.stroke?this.fill.stroke:l,e.d):(r.fillCircle(i,a,m,l,e.d),r.pat=r.dither[0],this.fill.stroke&&r.circle(i,a,m,this.fill.stroke,e.d));break;case 1:r.fillRect(i-m/2,a-m/2,m,m,l,e.d),this.fill.stroke&&r.rect(i-m/2,a-m/2,m,m,this.fill.stroke,e.d);break;case 2:r.pset(i,a,l,e.d);break;case 3:let o=[];for(let e=0;this.triangles.length>e;e++){let i=this.triangles[e],a=this.vert,r=[];for(let e=0;i.points.length>e;e++){let o=i.points[e];o=d(o,this.angle,0,0);let h=p(o.x*s+a.x,o.y*s+a.y,a.z,t);-1!=h.d&&500>h.d&&n(h,100)&&r.push(h)}3==r.length&&(r.color=i.color,o.push(r))}for(let t=0;o.length>t;t++){let i=o[t];r.fillTriangle(i[0],i[1],i[2],i.color,e.d)}}r.cursorColor2=64,r.pat=r.dither[0]}}}class g{constructor(t,e,i,a){this.location=new u(t,e,i),this.splats=a,this.splats.forEach(t=>{t.vert.x+=this.location.x,t.vert.y+=this.location.y,t.vert.z+=this.location.z})}updatePosition(t,e,i){this.location.x+=t,this.location.y+=e,this.location.z+=i,this.splats.forEach(a=>{a.vert.x+=t,a.vert.y+=e,a.vert.z+=i})}rotate(t,e,i){this.splats.forEach(a=>{a.vert.x-=this.location.x,a.vert.y-=this.location.y,a.vert.z-=this.location.z,a.vert=d(a.vert,t,e,i),a.vert.x+=this.location.x,a.vert.y+=this.location.y,a.vert.z+=this.location.z})}}class v{constructor(t,e,i){this.position={x:t,y:e,z:i},this.previousPosition={x:t,y:e,z:i},this.positionDelta={x:0,y:0,z:0},this.accelleration={x:0,y:0},this.maxAccelleration={x:.1,y:.1},this.minAccelleration={x:-.1,y:-.1},this.velocity={x:0,y:0},this.maxVelocity={x:2,y:2},this.minVelocity={x:-2,y:-2},this.drag={x:.9,y:.9},this.accellDrag={x:.5,y:.5},this.alive=!0,this.previousAngle=0,this.angle=Math.atan2(this.position.y,this.position.x),this.angleDelta=0,this.sprite=this.initializeShape()}draw(){this.sprite.splats.forEach(t=>t.draw(camera))}sa;update(){this.previousPosition.x=this.position.x,this.previousPosition.y=this.position.y,this.previousAngle=this.angle,this.velocity.x+=this.accelleration.x,this.velocity.y+=this.accelleration.y,this.velocity.x*=this.drag.x,this.velocity.y*=this.drag.y,this.velocity.x=c(this.velocity.x,this.minVelocity.x,this.maxVelocity.x),this.velocity.y=c(this.velocity.y,this.minVelocity.y,this.maxVelocity.y),this.accelleration.x*=this.accellDrag.x,this.accelleration.y*=this.accellDrag.y,this.accelleration.x=c(this.accelleration.x,this.minAccelleration.x,this.maxAccelleration.x),this.accelleration.y=c(this.accelleration.y,this.minAccelleration.y,this.maxAccelleration.y),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.angle=Math.atan2(this.position.y,this.position.x),this.positionDelta.x=this.position.x-this.previousPosition.x,this.positionDelta.y=this.position.y-this.previousPosition.y,this.positionDelta.z=this.position.z-this.previousPosition.z,this.angleDelta=this.angle-this.previousAngle,this.sprite.updatePosition(this.positionDelta.x,this.positionDelta.y,this.positionDelta.z),this.sprite.rotate(this.angleDelta,0,0)}move(t,e){this.accelleration.x+=t,this.accelleration.y+=e}initializeShape(){let t=[];t.push(new f(0,0,5,{shape:0,fill:{color1:21,color2:0,stroke:1,pattern:r.dither[0]},size:7}));for(let e=0;12>e;e++)t.push(new f(0,0,4-e/2,{shape:0,fill:{color1:21,color2:0,stroke:1,pattern:r.dither[0]},size:5}));for(let e=0;9>e;e++)t.push(new f(e/2-2,0,2,{shape:0,fill:{color1:21,color2:0,stroke:1,pattern:r.dither[0]},size:4}));for(let e=0;7>e;e++)t.push(new f(e/3-1,0,-1,{shape:0,fill:{color1:21,color2:0,stroke:1,pattern:r.dither[0]},size:4}));return new g(this.position.x,this.position.y,this.position.z,t)}}var E={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1},D={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,55,6],p:[1],c:[{n:[151,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154,154,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,135],f:[]}]}],rowLen:6014,patternLen:32,endPattern:0,numChannels:1},T={songData:[{i:[3,0,102,0,3,0,140,0,0,61,2,2,47,61,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],c:[{n:[147,,,,,147,,,,,,,,147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,147,,,,,135,,,,135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,229,4,40,43,51,0,0,0,231,6,1,3,23,13,0,32,232,4,7,6],p:[1],c:[{n:[147],f:[]}]},{i:[0,13,140,0,0,0,140,0,0,24,4,10,47,55,0,0,0,187,5,0,2,39,44,0,32,108,2,16,4],p:[1],c:[{n:[123,,,,,,120,,,,,125,,,,,,123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,124,,,,,,,,,,,,,,128,,,,,112],f:[]}]},{i:[0,255,116,79,0,111,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[123,125,,125,,,,123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,130],f:[]}]}],rowLen:1323,patternLen:128,endPattern:0,numChannels:4},I={songData:[{i:[0,0,140,0,0,0,140,0,0,130,255,158,220,0,0,0,0,51,1,1,2,58,165,0,32,88,1,157,2],p:[1],c:[{n:[135],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,255,35,9,65,0,0,0,0,51,2,1,2,17,239,0,32,88,1,85,2],p:[1],c:[{n:[,135,,135,,,,,,135,,,,,,,,,,135,,,,,,,,,135,,135,,,,,,,,,,,,135,,,,,,,,,135,135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,135,,,,,,,,,135,,,,,,,,,,,,,,,,,,,,,,,,,,137,,,,,,,137,,137,,,,137,,,,,,137,,,,,137,,,,,,,,135,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,135,,,,,,135,,,,,135,,,,,,135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,,,,,,,,,,,,,,,,,,,,,137,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,135],f:[]}]}],rowLen:5513,patternLen:128,endPattern:0,numChannels:2};800>innerWidth?(screenFactor=2,w=innerWidth/2,h=innerHeight/2):(screenFactor=4,w=Math.floor(innerWidth/4),h=Math.floor(innerHeight/4)),view={x:0,y:0,z:0},camera={},cursor={x:0,y:0,isDown:!1},viewTarget={x:0,y:0},then=0,elapsed=0,now=0,framesPerSecond=60,fpsInterval=1e3/60,window.t=1,splodes=[],splatShapes=[],window.lines=[],gamestate=0,paused=!1,debug=!1,started=!1,sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="";const A=w/2,C=h/2,b=document.createElement("style");function S(){window.player=new v(0,5,20),(()=>{for(let t=0;6.25>t;t++){let e=[];for(let t=0;24>t;t++){let i=42,n=2*Math.PI/24,o=s([1,31,32]),h=new f(Math.sin(n*t)*i,Math.cos(n*t)*i,t%2==0?0:40,{size:7.6,shape:3,fill:{color1:0,color2:s[1],pattern:r.dither[a(0,8)]},angle:2*Math.PI*(-t/24),triangles:[{points:[{x:-1,y:-1,z:0},{x:1,y:-1,z:0},{x:-1.6,y:1,z:0}],color:o},{points:[{x:-1.6,y:1,z:0},{x:1,y:-1,z:0},{x:1.6,y:1,z:0}],color:o}]});e.push(h)}splatShapes.push(new g(0,0,80*t,e))}let t=[];for(let e=0;1e3>e;e++){let e=6.283185307179586*Math.random()+0,i=44,n=new u(Math.sin(e)*i,Math.cos(e)*i,500/60*a(0,60)+a(0,20)),o=new f(n.x,n.y,n.z,{fill:{color1:s([1,31]),color2:s([1,31]),pattern:r.dither[s([7,8])]},shape:0,size:a(15,30)});t.push(o)}splatShapes.push(new g(0,0,0,t))})(),camera={camX:0,camY:0,camZ:-10,pitch:0,yaw:0,cx:A,cy:C,scale:300}}function H(){requestAnimationFrame(H),now=Date.now(),elapsed=now-then,elapsed>1e3/60&&(then=now-elapsed%(1e3/60),(()=>{switch(gamestate){case 0:r.clr(0,r.SCREEN),r.text([audioTxt,w/2-2,100,1,3,"center","top",1,22]),audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds?audioTxt="ALL SOUNDS RENDERED.\nTAP OR CLICK TO CONTINUE":started?audioTxt="SOUNDS RENDERING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds&&(gamestate=2,cursor.isDown=!1),r.render();break;case 3:(()=>{if(debug){let t=0>camera.camZ?"NEG "+camera.camZ:camera.camZ;if(debugText=`X ${camera.camX.toFixed(3)}\nY ${camera.camY}\nZ ${t}\nPITCH ${camera.pitch}\nYAW ${camera.yaw}\n${player.accelleration.x.toFixed(3)}`,l.isDown(l.w)){let t=1;camera.camX+=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ+=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY+=Math.sin(camera.pitch)*t}if(l.isDown(l.s)){let t=1;camera.camX-=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ-=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY-=Math.sin(camera.pitch)*t}if(l.isDown(l.a)){let t=1;camera.camX-=1*Math.cos(-camera.yaw)*t,camera.camZ-=1*Math.sin(-camera.yaw)*t,camera.camY-=0*t}if(l.isDown(l.d)){let t=1;camera.camX+=1*Math.cos(-camera.yaw)*t,camera.camZ+=1*Math.sin(-camera.yaw)*t,camera.camY+=0*t}l.isDown(l.UP)&&(camera.pitch+=.01),l.isDown(l.DOWN)&&(camera.pitch-=.01),l.isDown(l.LEFT)&&(camera.yaw-=.01),l.isDown(l.RIGHT)&&(camera.yaw+=.01)}else{t+=1;let e=0,i=splatShapes.length;for(;i>e;){let t=splatShapes[e],i=0,a=t.splats.length;for(;a>i;){let e=t.splats[i];e.vert.z-=7,-10>e.vert.z&&(e.vert.z=500),i++}e++}let a=.05;(l.isDown(l.w)||l.isDown(l.z)||l.isDown(l.UP))&&player.move(0,-a),(l.isDown(l.s)||l.isDown(l.DOWN))&&player.move(0,a),(l.isDown(l.a)||l.isDown(l.q)||l.isDown(l.LEFT))&&player.move(-a,0),(l.isDown(l.d)||l.isDown(l.RIGHT))&&player.move(a,0),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",t=>{player.move(.1*t.gamma,.1*t.beta)},!1),player.update()}})(),(()=>{r.clr(0,r.SCREEN),r.pat=r.dither[14],r.cursorColor2=0,r.fillRect(0,0,w,h,1,9999),r.cursorColor2=64,r.pat=r.dither[0],player.draw();let t=0,e=splatShapes.length;for(;e>t;){let e=splatShapes[t],i=0,a=e.splats.length;for(;a>i;)e.splats[i].draw(camera),i++;t++}debug&&r.text([debugText,10,10,1,3,"left","top",1,22]),r.render()})();break;case 2:(()=>{cursor.isDown=!1,r.clr(0,r.SCREEN);let t="THE WELL";r.text([t,w/2-2,100,2,3,"center","top",3,22]),t="CLICK TO BEGIN",r.text([t,w/2-2,120,1,3,"center","top",1,22]),r.render()})()}})()),l.justReleased(l.r)&&(gamestate=2,window.t=1,splodes=[],splatShapes=[],player.alive=!0,debug=!1,S()),l.justReleased(l.ZERO)&&(debug=!debug),l.update()}b.type="text/css",b.innerText="\n  canvas {display: inline-block; height:100%; width:100%;  image-rendering: pixelated;\n    image-rendering: crisp-edges; background-color: black;}\n\n  * {\n    overflow: hidden;\n    background-color: black;\n    margin: 0;\n    }\n",document.head.appendChild(b),atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRgYBAABXRUJQVlA4TPkAAAAvPwAAAAmAIPx/e4jof2oBEIT/bw8R/U/BbQAAZBPbrG0bm77naNt2L3FjAQCpfJvZtdk21m7QhbpU769xtW3XZicCAJBRmm1G6wHry3sBv3oJ2TaTzQgMgykOw60sEIPJ/NfmfEb0m+KfSWGWH/i/u8auMllLp0n52cfoLvVtXVYKFAcUZfWj5j87X4mHi8bzX1l8HrX3pPYcTlvOVVr9qo3Lavb/rXmB1LJcpoDHLXpMG3GbpNff9Hvj+WI8GbdW+8mBP7FawBlU3S655I2Sr7TX+Qybu3urf71W96O6lRfDTjcaDs1JZ6CujZezdr8z65838/1hdwAA",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),window.r=new e(w,h,atlas,10),window.playSound=o,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),H()},window.addEventListener("keyup",t=>{l.onKeyup(t)},!1),window.addEventListener("keydown",t=>{l.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),window.addEventListener("mousemove",()=>{},!1),window.addEventListener("mousedown",()=>{cursor.isDown=!0},!1),window.addEventListener("mouseup",()=>{cursor.isDown=!1},!1),window.addEventListener("touchstart",t=>{0==gamestate?onWindowInteraction(t):cursor.isDown=!0},!1),window.addEventListener("touchend",()=>{cursor.isDown=!1},!1),onWindowInteraction=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0!=soundsReady||started||(S(),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),compressor=audioCtx.createDynamicsCompressor(),compressor.threshold.setValueAtTime(-50,audioCtx.currentTime),compressor.knee.setValueAtTime(40,audioCtx.currentTime),compressor.ratio.setValueAtTime(12,audioCtx.currentTime),compressor.attack.setValueAtTime(0,audioCtx.currentTime),compressor.release.setValueAtTime(.25,audioCtx.currentTime),audioMaster.connect(compressor),compressor.connect(audioCtx.destination),sndData=[{name:"cellComplete",data:E},{name:"tada",data:D},{name:"rocksmash1",data:T},{name:"windrush",data:I}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{const e=new i;e.init(t.data);let a=!1;setInterval(()=>{if(!a&&(a=1==e.generate(),soundsReady+=a,a)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)}),started=!0);break;case 2:gamestate=3,o(sounds.windrush,1,0,.6,!0),setTimeout(()=>{o(sounds.windrush,1,0,.6,!0)},9e3);break;case 3:let t=2*(player.position.x- -40)/80-1;o(sounds.rocksmash1,1,t,.7,!1);break;case GAMEOVER:}},onclick=t=>{onWindowInteraction(t)},ontouchstart=t=>{onWindowInteraction(t)}}();
