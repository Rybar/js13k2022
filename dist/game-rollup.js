!function(){class e{constructor(t,e,i,s){this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=s,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.PAGE_3=3*this.PAGESIZE,this.PAGE_4=4*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=22,this.cursorColor2=64,this.stencil=!1,this.stencilSource=this.PAGE_2,this.stencilOffset=0,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES)}setPen(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i}clr(t,e){this.ram.fill(t,e,e+this.PAGESIZE)}pset(t,e,i,s=this.cursorColor2){t|=0,e|=0,i=this.stencil?this.pget(t,e,this.stencilSource)+this.stencilOffset:(0|i)%64;let r=this.pat&Math.pow(2,e%4*4+t%4)?i:s;64!=r&&(0>t|t>this.WIDTH-1||0>e|e>this.HEIGHT-1||(this.ram[this.renderTarget+e*this.WIDTH+t]=r))}pget(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]}line(t,e,i,s,r){var a,h,o=(s|=0)-(e|=0),n=(i|=0)-(t|=0);if(0>o?(o=-o,h=-1):h=1,0>n?(n=-n,a=-1):a=1,o<<=1,n<<=1,this.pset(t,e,r),n>o)for(var l=o-(n>>1);t!=i;)0>l||(e+=h,l-=n),l+=o,this.pset(t+=a,e,r);else for(l=n-(o>>1);e!=s;)0>l||(t+=a,l-=o),l+=n,this.pset(t,e+=h,r)}tline(t,e,i,s,r=0,a=0,h=0){var o,n,l=(s|=0)-(e|=0),c=(i|=0)-(t|=0);0>l?(l=-l,n=-1):n=1,0>c?(c=-c,o=-1):o=1;for(var d=t,f=e,u=(l<<=1)-((c<<=1)>>1);d!=i;)0>u||(f+=n,u-=c),u+=l,this.pset(d+=o,f,this.pget(d-r,f-a,this.renderSource)+h)}circle(t,e,i,s){t|=0,e|=0,s|=0;var r=-(i|=0),a=0,h=2-2*i;do{this.pset(t-r,e+a,s),this.pset(t-a,e-r,s),this.pset(t+r,e-a,s),this.pset(t+a,e+r,s),(i=h)>a||(h+=2*++a+1),(i>r||h>a)&&(h+=2*++r+1)}while(0>r)}fillCircle(t,e,i,s){if(t|=0,e|=0,s|=0,(i|=0)>=0){t|=0,e|=0;var r=-(i|=0),a=0,h=2-2*i;do{this.line(t-r,e-a,t+r,e-a,s),this.line(t-r,e+a,t+r,e+a,s),(i=h)>a||(h+=2*++a+1),(i>r||h>a)&&(h+=2*++r+1)}while(0>r)}}tfillCircle(t,e,i,s=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var r=-(i|=0),a=0,h=2-2*i;do{this.tline(t-r,e-a,t+r,e-a,offX,offY,s),this.tline(t-r,e+a,t+r,e+a,offX,offY,s),(i=h)>a||(h+=2*++a+1),(i>r||h>a)&&(h+=2*++r+1)}while(0>r)}}rect(t,e,i,s,r){let a=0|t,h=0|e,o=t+i|0,n=e+s|0;this.line(a,h,o,h,r|=this.cursorColor),this.line(o,h,o,n,r),this.line(a,n,o,n,r),this.line(a,h,a,n,r)}fillRect(t,e,i,s,r){let a=0|t,h=0|e,o=(t+i|0)-1,n=(e+s|0)-1;r=r;var l=Math.abs(n-h);if(this.line(a,h,o,h,r),l>0)for(;--l;)this.line(a,h+l,o,h+l,r);this.line(a,n,o,n,r)}sspr(t=0,e=0,i=16,s=16,r=0,a=0,h=32,o=32,n=!1,l=!1){var c=i/h,d=s/o;this.pat=this.dither[0];for(var f=0;o>f;f++)for(var u=0;h>u;u++)px=u*c|0,py=f*d|0,e=l?s-py-f:e,t=n?i-px-u:t,source=this.pget(t+px,e+py,this.renderSource),source>0&&this.pset(r+u,a+f,source)}outline(t,e,i,s,r,a){for(let t=0;this.WIDTH>=t;t++)for(let e=0;this.HEIGHT>=e;e++){let h=t-1+e*this.WIDTH,o=t+1+e*this.WIDTH,n=t+(e+1)*this.WIDTH,l=t+(e-1)*this.WIDTH;this.ram[this.renderSource+(t+e*this.WIDTH)]&&(64==this.ram[this.renderSource+h]&&(this.ram[this.renderTarget+h]=i),64==this.ram[this.renderSource+o]&&(this.ram[this.renderTarget+o]=r),64==this.ram[this.renderSource+l]&&(this.ram[this.renderTarget+l]=s),64==this.ram[this.renderSource+n]&&(this.ram[this.renderTarget+n]=a))}}triangle(t,e,i,s){this.line(t.x,t.y,e.x,e.y,s),this.line(e.x,e.y,i.x,i.y,s),this.line(i.x,i.y,t.x,t.y,s)}strokePolygon(t,e,i,s,r=0,a="white"){s=s||Math.floor(240*i)+16;for(let h=0;s>h;h++){let o=h/s*6.283185,n=(h+1)/s*6.283185;this.line(t+Math.cos(o+r)*i,e+Math.sin(o+r)*i,t+Math.cos(n+r)*i,e+Math.sin(n+r)*i,a)}}fillTriangle(t,e,i,s){let r=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),a=r[0],h=r[1],o=r[2],n=0,l=0,c=0,d={},f={};if(h.y-a.y>0&&(n=(h.x-a.x)/(h.y-a.y)),o.y-a.y>0&&(l=(o.x-a.x)/(o.y-a.y)),o.y-h.y>0&&(c=(o.x-h.x)/(o.y-h.y)),Object.assign(d,a),Object.assign(f,a),n>l){for(;h.y>=d.y;d.y++,f.y++,d.x+=l,f.x+=n)this.line(d.x,d.y,f.x,d.y,s);for(f=h;o.y>=d.y;d.y++,f.y++,d.x+=l,f.x+=c)this.line(d.x,d.y,f.x,d.y,s)}else{for(;h.y>=d.y;d.y++,f.y++,d.x+=n,f.x+=l)this.line(d.x,d.y,f.x,d.y,s);for(d=h;o.y>=d.y;d.y++,f.y++,d.x+=c,f.x+=l)this.line(d.x,d.y,f.x,d.y,s)}}imageToRam(t,e){let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let s=i.getContext("2d");s.drawImage(t,0,0);var r=s.getImageData(0,0,WIDTH,HEIGHT);let a=new Uint32Array(r.data.buffer);for(var h=0;a.length>h;h++)ram[e+h]=colors.indexOf(a[h])}render(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.c.width=this.c.width,this.ctx.putImageData(this.imageData,0,0)}textLine(t){let e=t[0].length;for(var i=0;e>i;i++){let e=this.getCharacter(t[0].charAt(i));for(var s=0;5>s;s++)for(var r=0;5>r;r++)1==e[5*s+r]&&(1==t[4]?this.pset(t[1]+r*t[4]+(5*t[4]+t[3])*i,t[2]+s*t[4]|0,t[5]):this.fillRect(t[1]+r*t[4]+(5*t[4]+t[3])*i,t[2]+s*t[4]|0,t[4],t[4],t[5]))}}text(t){let e=5*t[7],i=t[0].split("\n"),s=i.slice(0),r=i.length,a=s.sort((t,e)=>e.length-t.length)[0],h=a.length*e+(a.length-1)*t[3],o=r*e+(r-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var n=t[1],l=t[2],c=t[1]+h,d=t[2]+o;"center"==t[5]?(n=t[1]-h/2,c=t[1]+h/2):"right"==t[5]&&(n=t[1]-h,c=t[1]),"center"==t[6]?(l=t[2]-o/2,d=t[2]+o/2):"bottom"==t[6]&&(l=t[2]-o,d=t[2]);for(var f=n+h/2,u=l+o/2,y=0;r>y;y++){let s=i[y],r=s.length*e+(s.length-1)*t[3],a=t[1],h=t[2]+(e+t[4])*y;"center"==t[5]?a=t[1]-r/2:"right"==t[5]&&(a=t[1]-r),"center"==t[6]?h-=o/2:"bottom"==t[6]&&(h-=o),this.textLine([s,a,h,t[3],t[7],t[8]])}return{sx:n,sy:l,cx:f,cy:u,ex:c,ey:d,width:h,height:o}}getCharacter(t){let e=this.fontString.indexOf(t);return this.fontBitmap.substring(25*e,25*e+25).split("")}}var i=function(){var t,e,i,s,r,a=t=>Math.sin(6.283184*t),h=t=>.003959503758*2**((t-128)/12),o=(t,e,i)=>{var s,r,a,o,l,c,d=n[t.i[0]],f=t.i[1],u=t.i[3]/32,y=n[t.i[4]],w=t.i[5],p=t.i[8]/32,x=t.i[9],g=t.i[10]*t.i[10]*4,m=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,E=1/v,T=-t.i[13]/16,I=t.i[14],C=i*2**(2-t.i[15]),A=new Int32Array(g+m+v),S=0,D=0;for(s=0,r=0;g+m+v>s;s++,r++)0>r||(r-=C,l=h(e+(15&(I=I>>8|(255&I)<<4))+t.i[2]-128),c=h(e+(15&I)+t.i[6]-128)*(1+8e-4*t.i[7])),a=1,g>s?a=s/g:g+m>s||(a=(1-(a=(s-g-m)*E))*3**(T*a)),o=d(S+=l*a**u)*f,o+=y(D+=c*a**p)*w,x&&(o+=(2*Math.random()-1)*x),A[s]=80*o*a|0;return A},n=[a,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=a=>{t=a,i=0,s=a.rowLen*a.patternLen*((e=a.endPattern)+1)*2,r=new Int32Array(s)},this.generate=()=>{var h,l,c,d,f,u,y,w,p,x,g,m,v,E,T=new Int32Array(s),I=t.songData[i],C=t.rowLen,A=t.patternLen,S=0,D=0,M=!1,b=[];for(c=0;e>=c;++c)for(y=I.p[c],d=0;A>d;++d){var H=y?I.c[y-1].f[d]:0;H&&(I.i[H-1]=I.c[y-1].f[d+A]||0,17>H&&(b=[]));var L=n[I.i[16]],R=I.i[17]/512,P=2**(I.i[18]-9)/C,G=I.i[19],W=I.i[20],z=135.82764118168*I.i[21]/44100,N=1-I.i[22]/255,O=1e-5*I.i[23],k=I.i[24]/32,U=I.i[25]/512,Y=6.283184*2**(I.i[26]-9)/C,B=I.i[27]/255,X=I.i[28]*C&-2;for(g=(c*A+d)*C,f=0;4>f;++f)if(u=y?I.c[y-1].n[d+f*A]:0){b[u]||(b[u]=o(I,u,C));var j=b[u];for(l=0,h=2*g;j.length>l;l++,h+=2)T[h]+=j[l]}for(l=0;C>l;l++)(x=T[w=2*(g+l)])||M?(m=z,G&&(m*=L(P*w)*R+.5),D+=(m=1.5*Math.sin(m))*(v=N*(x-D)-(S+=m*D)),x=3==W?D:1==W?v:S,O&&(x=1>(x*=O)?x>-1?a(.25*x):-1:1,x/=O),M=(x*=k)*x>1e-5,E=x*(1-(p=Math.sin(Y*w)*U+.5)),x*=p):E=0,X>w||(E+=T[w-X+1]*B,x+=T[w-X]*B),T[w]=0|E,T[w+1]=0|x,r[w]+=0|E,r[w+1]+=0|x}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,s/2,44100),i=0;2>i;i++)for(var a=e.getChannelData(i),h=i;s>h;h+=2)a[h>>1]=r[h]/65536;return e},this.createWave=()=>{var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var a=0,h=44;s>a;++a){var o=r[a];i[h++]=255&(o=-32767>o?-32767:o>32767?32767:o),i[h++]=o>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),s=Array(e),a=0;2*e>a;a+=1){var h=i+a;s[a]=t>0&&r.length>h?r[h]/32768:0}return s}};class s{constructor(t,e,i,s){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=s}draw(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]}update(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)}}function a(t,e){return Math.floor(Math.random()*(e+1-t)+t)}function o(t,e,i){return t+(e-t)*i}function n(t,e=0){return t.x-view.x+e>0&&t.y-view.y+e>0&&t.x-view.x-e<w&&t.y-view.y-e<h}function l(t,e=1,i=0,s=.5,r=!1){var a=window.audioCtx.createBufferSource(),h=window.audioCtx.createGain(),o=window.audioCtx.createStereoPanner();return a.buffer=t,a.connect(o),o.connect(h),h.connect(audioMaster),a.playbackRate.value=e,a.loop=r,h.gain.value=s,o.pan.value=i,a.start(),{volume:h,sound:a}}const c={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,m:77,h:72,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};class d{constructor(t,e){this.x=t,this.y=e,this.size=47}draw(){r.fillRect(this.x-view.x,this.y-view.y,this.size,this.size,30),r.fillCircle(this.x+Math.floor(this.size/2)-view.x,this.y+Math.floor(this.size/2)-view.y,this.size/2-3,0),r.fillCircle(this.x+Math.floor(this.size/2)-view.x,this.y+Math.floor(this.size/2)-view.y,this.size/7,30)}update(){}}var f={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1},u={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,55,6],p:[1],c:[{n:[151,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154,154,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,135],f:[]}]}],rowLen:6014,patternLen:32,endPattern:0,numChannels:1};class p{constructor(t,e,i,s){this.types={EMPTY:0,WALL:1,DECOR:2},this.customDithers=[34952,17476,8738,4369],this.x=i,this.y=s,this.w=t,this.h=e,this.cellSize=8,this.cells=[],this.cells.length=t*e;for(let t=0;this.cells.length>t;t++)this.cells[t]={x:t%this.w,y:Math.floor(t/this.w),type:0,vined:!1,alive:a(0,100)>90,fill:{color1:0,color2:0,dither:0},flowerColor:a(2,63),offset:{x:0,y:0,scale:0}}}draw(){this.cells.forEach(t=>{n({x:t.x*this.cellSize,y:t.y*this.cellSize},16)&&t.type!=this.types.EMPTY&&(r.pat=t.fill.dither,r.cursorColor2=t.fill.color2,r.fillCircle(t.x*this.cellSize-view.x,t.y*this.cellSize-view.y,this.cellSize-t.offset.scale,t.fill.color1),r.pat=r.dither[0],r.cursorColor2=64)}),this.cells.forEach(t=>{n({x:t.x*this.cellSize,y:t.y*this.cellSize},16)&&t.type!=this.types.EMPTY&&t.alive&&(r.fillRect(t.x*this.cellSize-view.x+3,t.y*this.cellSize-view.y+3,2,2,t.flowerColor),r.fillRect(t.x*this.cellSize-view.x+7,t.y*this.cellSize-view.y+3,2,2,t.flowerColor),r.fillRect(t.x*this.cellSize-view.x+5,t.y*this.cellSize-view.y+1,2,2,t.flowerColor),r.fillRect(t.x*this.cellSize-view.x+5,t.y*this.cellSize-view.y+5,2,2,t.flowerColor))})}update(){this.cells.forEach(()=>{})}countAliveNeighbors(t,e){let i=0;for(let s=-1;2>s;s++)for(let r=-1;2>r;r++){if(0==s&&0==r)continue;let a=t+s,h=e+r;a>=0&&this.w>a&&h>=0&&this.h>h&&this.cells[a+h*this.w].type!=this.types.EMPTY&&i++}return i}getNeighbors(){let t=[];for(let e=-1;2>e;e++)for(let i=-1;2>i;i++){if(0==e&&0==i)continue;let s=x+e,r=y+i;s>=0&&this.w>s&&r>=0&&this.h>r&&t.push(this.cells[s+r*this.w])}return t}getCell(t,e){return this.cells[t+e*this.w]}doSimulationStep(t,e){let i=this.cells.map(t=>t);for(let s=0;this.cells.length>s;s++){let r=this.cells[s],a=this.countAliveNeighbors(r.x,r.y);i[s].type=r.type==this.types.WALL?e>a?this.types.EMPTY:this.types.WALL:a>t?this.types.WALL:this.types.EMPTY}this.cells=i,this.setFills()}setFills(){this.cells.forEach(t=>{if(t.type==this.types.WALL&&(t.fill.color1=15,t.fill.color2=16,t.fill.dither=r.dither[a(0,15)],t.offset.scale=a(1,3)),t.x>0&&t.y>0&&this.w>t.x&&this.h>t.y){this.getCell(t.x,t.y-1).type==this.types.EMPTY&&(t.fill={color1:13,color2:14,dither:r.dither[a(0,15)]});let e=this.getCell(t.x,t.y+1);null!=e&&e.type==this.types.EMPTY&&(t.fill.color1=13,t.fill.color2=14,t.fill.dither=r.dither[a(0,15)])}})}}800>innerWidth?(screenFactor=2,w=innerWidth/2,h=innerHeight/2):(screenFactor=3,w=Math.floor(innerWidth/3),h=Math.floor(innerHeight/3)),view={x:0,y:0},cursor={x:0,y:0,isDown:!1},viewTarget={x:0,y:0},then=0,elapsed=0,now=0,framesPerSecond=60,fpsInterval=1e3/60,window.t=1,splodes=[],fans=[],window.player=new class{constructor(t,e){this.x=t,this.y=e,this.width=8,this.height=8,this.speed={x:2,y:2},this.velocity={x:0,y:0},this.drag={x:.8,y:.8},this.target={x:0,y:0,distance:0},this.alive=!0}draw(){r.fillCircle(this.x-view.x,this.y-view.y+5*Math.sin(t/10),this.width/2,22)}update(){this.x+=this.velocity.x,this.y+=this.velocity.y;let e=this.target.x-this.x,i=this.target.y-this.y;return this.target.distance=Math.sqrt(e*e+i*i),5>this.target.distance&&(this.velocity.x*=this.drag.x,this.velocity.y*=this.drag.y),splodes.push(new s(this.x,this.y+7*Math.sin(t/10),a(5,10),a(18,22))),0}move(t,e){this.target.x=t,this.target.y=e;let i=Math.atan2(this.target.y-this.y,this.target.x-this.x);this.velocity.x=Math.cos(i)*this.speed.x,this.velocity.y=Math.sin(i)*this.speed.y}}(100,100),screenCenterX=w/2,screenCenterY=h/2,gamestate=0,paused=!1,started=!1,sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="";const g=document.createElement("style");function m(){window.map=new p(200,200,0,0),map.cells.forEach(t=>{t.type=.55>1*Math.random()+0?1:0});for(let t=0;5>t;t++)map.doSimulationStep(5,4);for(let t=0;10>t;t++)for(let t=0;100>t;t++){let t=a(0,map.w),e=a(0,map.h);if(1==map.cells[t+e*map.w].type){fans.push(new d(t*map.cellSize,e*map.cellSize));break}}}function v(){requestAnimationFrame(v),now=Date.now(),elapsed=now-then,elapsed>1e3/60&&(then=now-elapsed%(1e3/60),(()=>{switch(gamestate){case 0:r.clr(0,r.SCREEN),r.text([audioTxt,w/2-2,100,1,3,"center","top",1,22]),audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds?audioTxt="ALL SOUNDS RENDERED.\nTAP OR CLICK TO CONTINUE":started?audioTxt="SOUNDS RENDERING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",cursor.isDown&&soundsReady==totalSounds&&(gamestate=1),r.render();break;case 1:t+=1,splodes.forEach(t=>t.update()),(t=>{for(let e=0;t.length>e;e++)t[e].alive||t.splice(e,1)})(splodes),player.update(),viewTarget.x=player.x-screenCenterX,viewTarget.y=player.y-screenCenterY,view.x=o(view.x,viewTarget.x,.1),view.y=o(view.y,viewTarget.y,.1),c.justReleased(c.r)&&(window.t=1,splodes=[],m(),gamestate=1),r.clr(1,r.SCREEN),map.draw(),fans.forEach(t=>t.draw()),splodes.forEach(t=>t.draw()),player.draw(),r.render();break;case 2:(()=>{(c.justReleased(c.UP)||c.justReleased(c.w)||c.justReleased(c.z))&&(gamestate=1),r.clr(14,r.SCREEN);let t=Math.ceil(w/32),e=Math.ceil(h/32);for(let e=0;t>e;e++)r.line(32*e,0,32*e,r.HEIGHT,2);for(let t=0;e>t;t++)r.line(0,32*t,r.WIDTH,32*t,2);let i="TITLE SCREEN";r.text([i,w/2-2,100,2,3,"center","top",3,22]),i="CLICK TO BEGIN",r.text([i,w/2-2,120,1,3,"center","top",1,22]),r.render()})()}})()),c.update()}function E(t){let e=Math.floor(t.pageX/screenFactor),i=Math.floor(t.pageY/screenFactor)+view.y,r=e+view.x;cursor.isDown?splodes.push(new s(r,i,a(5,10),a(0,63))):player.move(r,i)}g.type="text/css",g.innerText="\n  canvas {display: inline-block; height:100%; width:100%;  image-rendering: pixelated;\n    image-rendering: crisp-edges; background-color: black;}\n\n  * {\n    overflow: hidden;\n    background-color: black;\n    margin: 0;\n    }\n",document.head.appendChild(g),atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRgYBAABXRUJQVlA4TPkAAAAvPwAAAAmAIPx/e4jof2oBEIT/bw8R/U/BbQAAZBPbrG0bm77naNt2L3FjAQCpfJvZtdk21m7QhbpU769xtW3XZicCAJBRmm1G6wHry3sBv3oJ2TaTzQgMgykOw60sEIPJ/NfmfEb0m+KfSWGWH/i/u8auMllLp0n52cfoLvVtXVYKFAcUZfWj5j87X4mHi8bzX1l8HrX3pPYcTlvOVVr9qo3Lavb/rXmB1LJcpoDHLXpMG3GbpNff9Hvj+WI8GbdW+8mBP7FawBlU3S655I2Sr7TX+Qybu3urf71W96O6lRfDTjcaDs1JZ6CujZezdr8z65838/1hdwAA",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),window.r=new e(w,h,atlas,10),window.playSound=l,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),v()},window.addEventListener("keyup",t=>{c.onKeyup(t)},!1),window.addEventListener("keydown",t=>{c.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),window.addEventListener("mousemove",t=>{cursor.isDown&&E(t)},!1),window.addEventListener("mousedown",t=>{cursor.isDown=!0,E(t)},!1),window.addEventListener("mouseup",t=>{cursor.isDown=!1,E(t)},!1),window.addEventListener("touchstart",t=>{0==gamestate?onWindowInteraction(t):(cursor.isDown=!0,E(t))},!1),window.addEventListener("touchend",()=>{cursor.isDown=!1},!1),onWindowInteraction=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0!=soundsReady||started||(m(),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),compressor=audioCtx.createDynamicsCompressor(),compressor.threshold.setValueAtTime(-60,audioCtx.currentTime),compressor.knee.setValueAtTime(40,audioCtx.currentTime),compressor.ratio.setValueAtTime(12,audioCtx.currentTime),compressor.attack.setValueAtTime(0,audioCtx.currentTime),compressor.release.setValueAtTime(.25,audioCtx.currentTime),audioMaster.connect(compressor),compressor.connect(audioCtx.destination),sndData=[{name:"cellComplete",data:f},{name:"tada",data:u}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{const e=new i;e.init(t.data);let s=!1;setInterval(()=>{if(!s&&(s=1==e.generate(),soundsReady+=s,s)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)}),started=!0);break;case 2:case 1:break;case GAMEOVER:}},onclick=t=>{onWindowInteraction(t)},ontouchstart=t=>{onWindowInteraction(t)}}();
