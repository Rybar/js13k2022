!function(){class e{constructor(t,e,i,r){this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=r,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.PAGE_3=3*this.PAGESIZE,this.PAGE_4=4*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=22,this.cursorColor2=64,this.stencil=!1,this.stencilSource=this.PAGE_2,this.stencilOffset=0,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.zbuf=new Float64Array(this.WIDTH*this.HEIGHT)}setPen(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i}clr(t,e){this.ram.fill(t,e,e+this.PAGESIZE),this.zbuf.fill(99999999,0,this.WIDTH*this.HEIGHT)}pset(t,e,i,r=0){if(0>t|t>this.WIDTH-1)return;if(0>e|e>this.HEIGHT-1)return;if(r>this.zbuf[e*this.WIDTH+t])return;t|=0,e|=0,i=this.stencil?this.pget(t,e,this.stencilSource)+this.stencilOffset:(0|i)%64;let a=this.pat&Math.pow(2,e%4*4+t%4)?i:this.cursorColor2;64!=a&&(this.ram[this.renderTarget+e*this.WIDTH+t]=a,this.zbuf[e*this.WIDTH+t]=r)}pget(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]}line(t,e,i,r,a,s=0){var n,o,h=(r|=0)-(e|=0),c=(i|=0)-(t|=0);if(0>h?(h=-h,o=-1):o=1,0>c?(c=-c,n=-1):n=1,h<<=1,c<<=1,this.pset(t,e,a,s),c>h)for(var l=h-(c>>1);t!=i;)0>l||(e+=o,l-=c),l+=h,this.pset(t+=n,e,a,s);else for(l=c-(h>>1);e!=r;)0>l||(t+=n,l-=h),l+=c,this.pset(t,e+=o,a,s)}tline(t,e,i,r,a=0,s=0,n=0,o=0){var h,c,l=(r|=0)-(e|=0),d=(i|=0)-(t|=0);0>l?(l=-l,c=-1):c=1,0>d?(d=-d,h=-1):h=1;for(var u=t,f=e,m=(l<<=1)-((d<<=1)>>1);u!=i;)0>m||(f+=c,m-=d),m+=l,this.pset(u+=h,f,this.pget(u-a,f-s,this.renderSource)+n)}circle(t,e,i,r,a=0){t|=0,e|=0,r|=0;var s=-(i|=0),n=0,o=2-2*i;do{this.pset(t-s,e+n,r,a),this.pset(t-n,e-s,r,a),this.pset(t+s,e-n,r,a),this.pset(t+n,e+s,r,a),(i=o)>n||(o+=2*++n+1),(i>s||o>n)&&(o+=2*++s+1)}while(0>s)}fillCircle(t,e,i,r,a=0){if(t|=0,e|=0,r|=0,(i|=0)>=0){t|=0,e|=0;var s=-(i|=0),n=0,o=2-2*i;do{this.line(t-s,e-n,t+s,e-n,r,a),this.line(t-s,e+n,t+s,e+n,r,a),(i=o)>n||(o+=2*++n+1),(i>s||o>n)&&(o+=2*++s+1)}while(0>s)}}tfillCircle(t,e,i,r=0,a=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var s=-(i|=0),n=0,o=2-2*i;do{this.tline(t-s,e-n,t+s,e-n,offX,offY,r,a),this.tline(t-s,e+n,t+s,e+n,offX,offY,r,a),(i=o)>n||(o+=2*++n+1),(i>s||o>n)&&(o+=2*++s+1)}while(0>s)}}rect(t,e,i,r,a,s=0){let n=0|t,o=0|e,h=t+i|0,c=e+r|0;this.line(n,o,h,o,a,s),this.line(h,o,h,c,a,s),this.line(n,c,h,c,a,s),this.line(n,o,n,c,a,s)}fillRect(t,e,i,r,a,s=0){let n=0|t,o=0|e,h=(t+i|0)-1,c=(e+r|0)-1;a=a;var l=Math.abs(c-o);if(this.line(n,o,h,o,a,s),l>0)for(;--l;)this.line(n,o+l,h,o+l,a,s);this.line(n,c,h,c,a,s)}sspr(t=0,e=0,i=16,r=16,a=0,s=0,n=32,o=32,h=!1,c=!1,l=0){var d=i/n,u=r/o;this.pat=this.dither[0];for(var f=0;o>f;f++)for(var m=0;n>m;m++)px=m*d|0,py=f*u|0,e=c?r-py-f:e,t=h?i-px-m:t,source=this.pget(t+px,e+py,this.renderSource),source>0&&this.pset(a+m,s+f,source)}outline(t,e,i,r,a,s){for(let t=0;this.WIDTH>=t;t++)for(let e=0;this.HEIGHT>=e;e++){let n=t-1+e*this.WIDTH,o=t+1+e*this.WIDTH,h=t+(e+1)*this.WIDTH,c=t+(e-1)*this.WIDTH;this.ram[this.renderSource+(t+e*this.WIDTH)]&&(64==this.ram[this.renderSource+n]&&(this.ram[this.renderTarget+n]=i),64==this.ram[this.renderSource+o]&&(this.ram[this.renderTarget+o]=a),64==this.ram[this.renderSource+c]&&(this.ram[this.renderTarget+c]=r),64==this.ram[this.renderSource+h]&&(this.ram[this.renderTarget+h]=s))}}triangle(t,e,i,r,a=0){this.line(t.x,t.y,e.x,e.y,r),this.line(e.x,e.y,i.x,i.y,r),this.line(i.x,i.y,t.x,t.y,r)}strokePolygon(t,e,i,r,a=0,s="white"){r=r||Math.floor(240*i)+16;for(let n=0;r>n;n++){let o=n/r*6.283185,h=(n+1)/r*6.283185;this.line(t+Math.cos(o+a)*i,e+Math.sin(o+a)*i,t+Math.cos(h+a)*i,e+Math.sin(h+a)*i,s)}}fillTriangle(t,e,i,r){let a=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),s=a[0],n=a[1],o=a[2],h=0,c=0,l=0,d={},u={};if(n.y-s.y>0&&(h=(n.x-s.x)/(n.y-s.y)),o.y-s.y>0&&(c=(o.x-s.x)/(o.y-s.y)),o.y-n.y>0&&(l=(o.x-n.x)/(o.y-n.y)),Object.assign(d,s),Object.assign(u,s),h>c){for(;n.y>=d.y;d.y++,u.y++,d.x+=c,u.x+=h)this.line(d.x,d.y,u.x,d.y,r);for(u=n;o.y>=d.y;d.y++,u.y++,d.x+=c,u.x+=l)this.line(d.x,d.y,u.x,d.y,r)}else{for(;n.y>=d.y;d.y++,u.y++,d.x+=h,u.x+=c)this.line(d.x,d.y,u.x,d.y,r);for(d=n;o.y>=d.y;d.y++,u.y++,d.x+=l,u.x+=c)this.line(d.x,d.y,u.x,d.y,r)}}imageToRam(t,e){let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let r=i.getContext("2d");r.drawImage(t,0,0);var a=r.getImageData(0,0,WIDTH,HEIGHT);let s=new Uint32Array(a.data.buffer);for(var n=0;s.length>n;n++)ram[e+n]=colors.indexOf(s[n])}render(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.c.width=this.c.width,this.ctx.putImageData(this.imageData,0,0)}textLine(t){let e=t[0].length;for(var i=0;e>i;i++){let e=this.getCharacter(t[0].charAt(i));for(var r=0;5>r;r++)for(var a=0;5>a;a++)1==e[5*r+a]&&(1==t[4]?this.pset(t[1]+a*t[4]+(5*t[4]+t[3])*i,t[2]+r*t[4]|0,t[5]):this.fillRect(t[1]+a*t[4]+(5*t[4]+t[3])*i,t[2]+r*t[4]|0,t[4],t[4],t[5]))}}text(t){let e=5*t[7],i=t[0].split("\n"),r=i.slice(0),a=i.length,s=r.sort((t,e)=>e.length-t.length)[0],n=s.length*e+(s.length-1)*t[3],o=a*e+(a-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var h=t[1],c=t[2],l=t[1]+n,d=t[2]+o;"center"==t[5]?(h=t[1]-n/2,l=t[1]+n/2):"right"==t[5]&&(h=t[1]-n,l=t[1]),"center"==t[6]?(c=t[2]-o/2,d=t[2]+o/2):"bottom"==t[6]&&(c=t[2]-o,d=t[2]);for(var u=h+n/2,f=c+o/2,m=0;a>m;m++){let r=i[m],a=r.length*e+(r.length-1)*t[3],s=t[1],n=t[2]+(e+t[4])*m;"center"==t[5]?s=t[1]-a/2:"right"==t[5]&&(s=t[1]-a),"center"==t[6]?n-=o/2:"bottom"==t[6]&&(n-=o),this.textLine([r,s,n,t[3],t[7],t[8]])}return{sx:h,sy:c,cx:u,cy:f,ex:l,ey:d,width:n,height:o}}getCharacter(t){let e=this.fontString.indexOf(t);return this.fontBitmap.substring(25*e,25*e+25).split("")}}var i=function(){var t,e,i,r,a,s=t=>Math.sin(6.283184*t),n=t=>.003959503758*2**((t-128)/12),o=(t,e,i)=>{var r,a,s,o,c,l,d=h[t.i[0]],u=t.i[1],f=t.i[3]/32,m=h[t.i[4]],p=t.i[5],w=t.i[8]/32,y=t.i[9],x=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,E=1/v,I=-t.i[13]/16,T=t.i[14],C=i*2**(2-t.i[15]),A=new Int32Array(x+g+v),D=0,M=0;for(r=0,a=0;x+g+v>r;r++,a++)0>a||(a-=C,c=n(e+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),l=n(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),s=1,x>r?s=r/x:x+g>r||(s=(1-(s=(r-x-g)*E))*3**(I*s)),o=d(D+=c*s**f)*u,o+=m(M+=l*s**w)*p,y&&(o+=(2*Math.random()-1)*y),A[r]=80*o*s|0;return A},h=[s,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=s=>{t=s,i=0,r=s.rowLen*s.patternLen*((e=s.endPattern)+1)*2,a=new Int32Array(r)},this.generate=()=>{var n,c,l,d,u,f,m,p,w,y,x,g,v,E,I=new Int32Array(r),T=t.songData[i],C=t.rowLen,A=t.patternLen,D=0,M=0,H=!1,b=[];for(l=0;e>=l;++l)for(m=T.p[l],d=0;A>d;++d){var S=m?T.c[m-1].f[d]:0;S&&(T.i[S-1]=T.c[m-1].f[d+A]||0,17>S&&(b=[]));var G=h[T.i[16]],P=T.i[17]/512,R=2**(T.i[18]-9)/C,W=T.i[19],L=T.i[20],z=135.82764118168*T.i[21]/44100,N=1-T.i[22]/255,O=1e-5*T.i[23],X=T.i[24]/32,Z=T.i[25]/512,k=6.283184*2**(T.i[26]-9)/C,U=T.i[27]/255,Y=T.i[28]*C&-2;for(x=(l*A+d)*C,u=0;4>u;++u)if(f=m?T.c[m-1].n[d+u*A]:0){b[f]||(b[f]=o(T,f,C));var B=b[f];for(c=0,n=2*x;B.length>c;c++,n+=2)I[n]+=B[c]}for(c=0;C>c;c++)(y=I[p=2*(x+c)])||H?(g=z,W&&(g*=G(R*p)*P+.5),M+=(g=1.5*Math.sin(g))*(v=N*(y-M)-(D+=g*M)),y=3==L?M:1==L?v:D,O&&(y=1>(y*=O)?y>-1?s(.25*y):-1:1,y/=O),H=(y*=X)*y>1e-5,E=y*(1-(w=Math.sin(k*p)*Z+.5)),y*=w):E=0,Y>p||(E+=I[p-Y+1]*U,y+=I[p-Y]*U),I[p]=0|E,I[p+1]=0|y,a[p]+=0|E,a[p+1]+=0|y}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,r/2,44100),i=0;2>i;i++)for(var s=e.getChannelData(i),n=i;r>n;n+=2)s[n>>1]=a[n]/65536;return e},this.createWave=()=>{var t=44+2*r-8,e=t-36,i=new Uint8Array(44+2*r);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var s=0,n=44;r>s;++s){var o=a[s];i[n++]=255&(o=-32767>o?-32767:o>32767?32767:o),i[n++]=o>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),r=Array(e),s=0;2*e>s;s+=1){var n=i+s;r[s]=t>0&&a.length>n?a[n]/32768:0}return r}};class a{constructor(t,e,i,r){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=r}draw(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]}update(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)}}function s(t,e){return Math.floor(Math.random()*(e+1-t)+t)}function n(t,e){return Math.random()*(e-t)+t}function o(t,e=1,i=0,r=.5,a=!1){var s=window.audioCtx.createBufferSource(),n=window.audioCtx.createGain(),o=window.audioCtx.createStereoPanner();return s.buffer=t,s.connect(o),o.connect(n),n.connect(audioMaster),s.playbackRate.value=e,s.loop=a,n.gain.value=r,o.pan.value=i,s.start(),{volume:n,sound:s}}const c={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,q:81,r:82,m:77,h:72,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};var l={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1},d={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,55,6],p:[1],c:[{n:[151,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154,154,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,135],f:[]}]}],rowLen:6014,patternLen:32,endPattern:0,numChannels:1};function u(t,e,i){this.x=t,this.y=e,this.z=i}const f={CIRCLE:0,SQUARE:1,POINT:2};class m{constructor(t,e,i,a={fill:{color1:22,color2:0,pattern:r.dither[0]},shape:f.point,size:1}){this.vert=new u(t,e,i),this.size=a.size,this.shape=a.shape,this.fill=a.fill}draw(t){let e=((t,e,i,r)=>{var a,s,{cos:n,sin:o,sqrt:h,atan2:c}=Math;e-=r.camY,a=c(t-=r.camX,i-=r.camZ),s=h(t*t+i*i),t=o(a-r.yaw)*s,a=c(e,i=n(a-r.yaw)*s),s=h(e*e+i*i),e=o(a-r.pitch)*s;var l=200*((i=n(a-r.pitch)*s)-0)-0*(t-0),d=(1*(t-0)- -100*(i-0))/l,u=200/l;return d>0&&1>d&&u>0&&1>u?{x:r.cx+(200*d-100)*r.scale,y:r.cy+e/i*r.scale,d:h(t*t+e*e+i*i)}:{d:-1}})(this.vert.x,this.vert.y,this.vert.z,t);if(-1!=e.d&&1500>e.d){var{x:i,y:a}=e,s=this.size,n=this.shape,o=this.fill,{color1:h,color2:c,pattern:l}=o;e.d>1450&&(h=2),e.d>1475&&(c=2,h=1);var d=40/e.d,u=s*d;0==n?(r.cursorColor2=c,r.pat=l,1>u?r.pset(i,a,h,e.d):(r.fillCircle(i,a,u,h,e.d),r.pat=r.dither[0]),r.cursorColor2=64,r.pat=r.dither[0]):1==n?(r.cursorColor2=c,r.pat=l,r.fillRect(i-u/2,a-u/2,s*d,s*d,h,e.d)):2==n&&(r.pat=l,r.pset(i,a,h,e.d)),r.cursorColor2=64,r.pat=r.dither[0]}}}function p(t,e,i,r){var a=Math.random(),s=Math.random(),n=2*Math.PI*a,o=Math.acos(2*s-1);return new u(t+r*Math.sin(o)*Math.cos(n),e+r*Math.sin(o)*Math.sin(n),i+r*Math.cos(o))}800>innerWidth?(screenFactor=2,w=innerWidth/2,h=innerHeight/2):(screenFactor=3,w=Math.floor(innerWidth/3),h=Math.floor(innerHeight/3)),view={x:0,y:0,z:0},camera={},cursor={x:0,y:0,isDown:!1},viewTarget={x:0,y:0},then=0,elapsed=0,now=0,framesPerSecond=60,fpsInterval=1e3/60,window.t=1,splodes=[],fans=[],splats=[],splatLines=[],window.player=new class{constructor(t,e,i=0){this.x=t,this.y=e,this.z=i,this.width=8,this.height=8,this.speed={x:2,y:2},this.velocity={x:0,y:0},this.drag={x:.8,y:.8},this.target={x:0,y:0,distance:0},this.alive=!0}draw(){r.fillCircle(this.x-view.x,this.y-view.y+5*Math.sin(t/10),this.width/2,22)}update(){this.x+=this.velocity.x,this.y+=this.velocity.y;let e=this.target.x-this.x,i=this.target.y-this.y;return this.target.distance=Math.sqrt(e*e+i*i),5>this.target.distance&&(this.velocity.x*=this.drag.x,this.velocity.y*=this.drag.y),splodes.push(new a(this.x,this.y+7*Math.sin(t/10),s(5,10),s(18,22))),0}move(t,e){this.target.x=t,this.target.y=e;let i=Math.atan2(this.target.y-this.y,this.target.x-this.x);this.velocity.x=Math.cos(i)*this.speed.x,this.velocity.y=Math.sin(i)*this.speed.y}}(100,100),screenCenterX=w/2,screenCenterY=h/2,gamestate=0,paused=!1,started=!1,sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="";const g=document.createElement("style");function v(){for(let i=0;10>i;i++){var t=new u(n(-300,300),n(-300,300),n(-300,300));spread=n(5,50);for(let i=0;4e3>i;i++){let i=s(0,63),a=i++,o=p(t.x,t.y,t.z,spread),h=new m(o.x,o.y,o.z,{fill:{color1:i,color2:a,pattern:r.dither[8]},shape:(e=[0,1],e[s(0,e.length-1)]),size:n(5,15)});splats.push(h)}}var e;for(let t=0;15e3>t;t++){let t=700,e=s(16,19),i=e++,a=p(0,0,0,t),o=new m(a.x,a.y,a.z,{fill:{color1:e,color2:i,pattern:r.dither[0]},shape:0,size:n(3,5)});splats.push(o)}splats.sort((t,e)=>t.vert.z-e.vert.z),camera={camX:0,camY:0,camZ:-200,pitch:0,yaw:0,cx:screenCenterX,cy:screenCenterY,scale:500}}function E(){requestAnimationFrame(E),now=Date.now(),elapsed=now-then,elapsed>1e3/60&&(then=now-elapsed%(1e3/60),(()=>{switch(gamestate){case 0:r.clr(0,r.SCREEN),r.text([audioTxt,w/2-2,100,1,3,"center","top",1,22]),audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds?audioTxt="ALL SOUNDS RENDERED.\nTAP OR CLICK TO CONTINUE":started?audioTxt="SOUNDS RENDERING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",cursor.isDown&&soundsReady==totalSounds&&(gamestate=1),r.render();break;case 1:(()=>{if(t+=1,splodes.forEach(t=>t.update()),splats.forEach(t=>{newPoint=(t=>{var{cos:e,sin:i}=Math,r=e(0),a=i(0),s=e(0),n=i(0),o=e(-0),h=i(-0);return{x:r*s*t.x+(r*n*h-a*o)*t.y+(r*n*o+a*h)*t.z,y:a*s*t.x+(a*n*h+r*o)*t.y+(a*n*o-r*h)*t.z,z:-n*t.x+s*h*t.y+s*o*t.z}})(t.vert),t.vert.x=newPoint.x,t.vert.y=newPoint.y,t.vert.z=newPoint.z}),(t=>{for(let e=0;t.length>e;e++)t[e].alive||t.splice(e,1)})(splodes),viewTarget.x=player.x-screenCenterX,viewTarget.y=player.y-screenCenterY,view.y=(e=view.y)+.1*(viewTarget.y-e),c.justReleased(c.r)&&(window.t=1,splodes=[],v(),gamestate=1),c.isDown(c.w)){let t=5;camera.camX+=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ+=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY+=Math.sin(camera.pitch)*t}var e;if(c.isDown(c.s)){let t=5;camera.camX-=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ-=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY-=Math.sin(camera.pitch)*t}c.isDown(c.UP)&&(camera.pitch+=.01),c.isDown(c.DOWN)&&(camera.pitch-=.01),c.isDown(c.LEFT)&&(camera.yaw-=.01),c.isDown(c.RIGHT)&&(camera.yaw+=.01);let i=0>camera.camZ?"NEG "+camera.camZ:camera.camZ;debugtxt=`X ${camera.camX.toFixed(3)}\nY ${camera.camY}\nZ ${i}\nPITCH ${camera.pitch}\nYAW ${camera.yaw}`})(),r.clr(1,r.SCREEN),splats.forEach(t=>t.draw(camera)),r.text([debugtxt,10,10,1,3,"left","top",1,22]),r.render();break;case 2:(()=>{(c.justReleased(c.UP)||c.justReleased(c.w)||c.justReleased(c.z))&&(gamestate=1),r.clr(14,r.SCREEN);let t=Math.ceil(w/32),e=Math.ceil(h/32);for(let e=0;t>e;e++)r.line(32*e,0,32*e,r.HEIGHT,2);for(let t=0;e>t;t++)r.line(0,32*t,r.WIDTH,32*t,2);let i="TITLE SCREEN";r.text([i,w/2-2,100,2,3,"center","top",3,22]),i="CLICK TO BEGIN",r.text([i,w/2-2,120,1,3,"center","top",1,22]),r.render()})()}})()),c.update()}function I(t){let e=Math.floor(t.pageX/screenFactor),i=Math.floor(t.pageY/screenFactor)+view.y,r=e+view.x;cursor.isDown?splodes.push(new a(r,i,s(5,10),s(0,63))):player.move(r,i)}g.type="text/css",g.innerText="\n  canvas {display: inline-block; height:100%; width:100%;  image-rendering: pixelated;\n    image-rendering: crisp-edges; background-color: black;}\n\n  * {\n    overflow: hidden;\n    background-color: black;\n    margin: 0;\n    }\n",document.head.appendChild(g),atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRgYBAABXRUJQVlA4TPkAAAAvPwAAAAmAIPx/e4jof2oBEIT/bw8R/U/BbQAAZBPbrG0bm77naNt2L3FjAQCpfJvZtdk21m7QhbpU769xtW3XZicCAJBRmm1G6wHry3sBv3oJ2TaTzQgMgykOw60sEIPJ/NfmfEb0m+KfSWGWH/i/u8auMllLp0n52cfoLvVtXVYKFAcUZfWj5j87X4mHi8bzX1l8HrX3pPYcTlvOVVr9qo3Lavb/rXmB1LJcpoDHLXpMG3GbpNff9Hvj+WI8GbdW+8mBP7FawBlU3S655I2Sr7TX+Qybu3urf71W96O6lRfDTjcaDs1JZ6CujZezdr8z65838/1hdwAA",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),window.r=new e(w,h,atlas,10),window.playSound=o,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),E()},window.addEventListener("keyup",t=>{c.onKeyup(t)},!1),window.addEventListener("keydown",t=>{c.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),window.addEventListener("mousemove",t=>{cursor.isDown&&I(t)},!1),window.addEventListener("mousedown",t=>{cursor.isDown=!0,I(t)},!1),window.addEventListener("mouseup",t=>{cursor.isDown=!1,I(t)},!1),window.addEventListener("touchstart",t=>{0==gamestate?onWindowInteraction(t):(cursor.isDown=!0,I(t))},!1),window.addEventListener("touchend",()=>{cursor.isDown=!1},!1),onWindowInteraction=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0!=soundsReady||started||(v(),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),compressor=audioCtx.createDynamicsCompressor(),compressor.threshold.setValueAtTime(-60,audioCtx.currentTime),compressor.knee.setValueAtTime(40,audioCtx.currentTime),compressor.ratio.setValueAtTime(12,audioCtx.currentTime),compressor.attack.setValueAtTime(0,audioCtx.currentTime),compressor.release.setValueAtTime(.25,audioCtx.currentTime),audioMaster.connect(compressor),compressor.connect(audioCtx.destination),sndData=[{name:"cellComplete",data:l},{name:"tada",data:d}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{const e=new i;e.init(t.data);let r=!1;setInterval(()=>{if(!r&&(r=1==e.generate(),soundsReady+=r,r)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)}),started=!0);break;case 2:case 1:break;case GAMEOVER:}},onclick=t=>{onWindowInteraction(t)},ontouchstart=t=>{onWindowInteraction(t)}}();
