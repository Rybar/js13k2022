!function(){class e{constructor(t,e,i,a){this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=a,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.PAGE_3=3*this.PAGESIZE,this.PAGE_4=4*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=22,this.cursorColor2=64,this.stencil=!1,this.stencilSource=this.PAGE_2,this.stencilOffset=0,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.zbuf=new Float64Array(this.WIDTH*this.HEIGHT)}setPen(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i}clr(t,e){this.ram.fill(t,e,e+this.PAGESIZE),this.zbuf.fill(9999999999,0,this.WIDTH*this.HEIGHT)}pset(t,e,i,a=0){if(0>t|t>this.WIDTH-1)return;if(0>e|e>this.HEIGHT-1)return;if(a>this.zbuf[e*this.WIDTH+t])return;t|=0,e|=0,i=this.stencil?this.pget(t,e,this.stencilSource)+this.stencilOffset:(0|i)%64;let s=this.pat&Math.pow(2,e%4*4+t%4)?i:this.cursorColor2;64!=s&&(this.ram[this.renderTarget+e*this.WIDTH+t]=s,this.zbuf[e*this.WIDTH+t]=a)}pget(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]}line(t,e,i,a,s,r=0){var n,h,o=(a|=0)-(e|=0),c=(i|=0)-(t|=0);if(0>o?(o=-o,h=-1):h=1,0>c?(c=-c,n=-1):n=1,o<<=1,c<<=1,this.pset(t,e,s,r),c>o)for(var l=o-(c>>1);t!=i;)0>l||(e+=h,l-=c),l+=o,this.pset(t+=n,e,s,r);else for(l=c-(o>>1);e!=a;)0>l||(t+=n,l-=o),l+=c,this.pset(t,e+=h,s,r)}line3d(t,e,i,a,s,r,n){var h,o,c,l=(s|=0)-(e|=0),d=(a|=0)-(t|=0),u=r-i,f=[];if(0>l?(l=-l,o=-1):o=1,0>d?(d=-d,h=-1):h=1,l<<=1,d<<=1,this.pset(t,e,n,i),d>l)for(var m=l-(d>>1);t!=a;)0>m||(e+=o,m-=d),m+=l,f.push({x:t+=h,y:e});else for(m=d-(l>>1);e!=s;)0>m||(t+=h,m-=l),m+=d,f.push({x:t,y:e+=o});c=u/f.length;for(let t=0;f.length>t;t++)this.pset(f[t].x,f[t].y,n,c*t+i)}tline(t,e,i,a,s=0,r=0,n=0,h=0){var o,c,l=(a|=0)-(e|=0),d=(i|=0)-(t|=0);0>l?(l=-l,c=-1):c=1,0>d?(d=-d,o=-1):o=1;for(var u=t,f=e,m=(l<<=1)-((d<<=1)>>1);u!=i;)0>m||(f+=c,m-=d),m+=l,this.pset(u+=o,f,this.pget(u-s,f-r,this.renderSource)+n)}circle(t,e,i,a,s=0){t|=0,e|=0,a|=0;var r=-(i|=0),n=0,h=2-2*i;do{this.pset(t-r,e+n,a,s),this.pset(t-n,e-r,a,s),this.pset(t+r,e-n,a,s),this.pset(t+n,e+r,a,s),(i=h)>n||(h+=2*++n+1),(i>r||h>n)&&(h+=2*++r+1)}while(0>r)}fillCircle(t,e,i,a,s=0){if(t|=0,e|=0,a|=0,(i|=0)>=0){t|=0,e|=0;var r=-(i|=0),n=0,h=2-2*i;do{this.line(t-r,e-n,t+r,e-n,a,s),this.line(t-r,e+n,t+r,e+n,a,s),(i=h)>n||(h+=2*++n+1),(i>r||h>n)&&(h+=2*++r+1)}while(0>r)}}tfillCircle(t,e,i,a=0,s=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var r=-(i|=0),n=0,h=2-2*i;do{this.tline(t-r,e-n,t+r,e-n,offX,offY,a,s),this.tline(t-r,e+n,t+r,e+n,offX,offY,a,s),(i=h)>n||(h+=2*++n+1),(i>r||h>n)&&(h+=2*++r+1)}while(0>r)}}rect(t,e,i,a,s,r=0){let n=0|t,h=0|e,o=t+i|0,c=e+a|0;this.line(n,h,o,h,s,r),this.line(o,h,o,c,s,r),this.line(n,c,o,c,s,r),this.line(n,h,n,c,s,r)}fillRect(t,e,i,a,s,r=0){let n=0|t,h=0|e,o=(t+i|0)-1,c=(e+a|0)-1;s=s;var l=Math.abs(c-h);if(this.line(n,h,o,h,s,r),l>0)for(;--l;)this.line(n,h+l,o,h+l,s,r);this.line(n,c,o,c,s,r)}sspr(t=0,e=0,i=16,a=16,s=0,r=0,n=32,h=32,o=!1,c=!1,l=0){var d=i/n,u=a/h;this.pat=this.dither[0];for(var f=0;h>f;f++)for(var m=0;n>m;m++)px=m*d|0,py=f*u|0,e=c?a-py-f:e,t=o?i-px-m:t,source=this.pget(t+px,e+py,this.renderSource),source>0&&this.pset(s+m,r+f,source)}outline(t,e,i,a,s,r){for(let t=0;this.WIDTH>=t;t++)for(let e=0;this.HEIGHT>=e;e++){let n=t-1+e*this.WIDTH,h=t+1+e*this.WIDTH,o=t+(e+1)*this.WIDTH,c=t+(e-1)*this.WIDTH;this.ram[this.renderSource+(t+e*this.WIDTH)]&&(64==this.ram[this.renderSource+n]&&(this.ram[this.renderTarget+n]=i),64==this.ram[this.renderSource+h]&&(this.ram[this.renderTarget+h]=s),64==this.ram[this.renderSource+c]&&(this.ram[this.renderTarget+c]=a),64==this.ram[this.renderSource+o]&&(this.ram[this.renderTarget+o]=r))}}triangle(t,e,i,a,s=0){this.line(t.x,t.y,e.x,e.y,a),this.line(e.x,e.y,i.x,i.y,a),this.line(i.x,i.y,t.x,t.y,a)}strokePolygon(t,e,i,a,s=0,r="white"){a=a||Math.floor(240*i)+16;for(let n=0;a>n;n++){let h=n/a*6.283185,o=(n+1)/a*6.283185;this.line(t+Math.cos(h+s)*i,e+Math.sin(h+s)*i,t+Math.cos(o+s)*i,e+Math.sin(o+s)*i,r)}}fillTriangle(t,e,i,a,s){let r=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),n=r[0],h=r[1],o=r[2],c=0,l=0,d=0,u={},f={};if(h.y-n.y>0&&(c=(h.x-n.x)/(h.y-n.y)),o.y-n.y>0&&(l=(o.x-n.x)/(o.y-n.y)),o.y-h.y>0&&(d=(o.x-h.x)/(o.y-h.y)),Object.assign(u,n),Object.assign(f,n),c>l){for(;h.y>=u.y;u.y++,f.y++,u.x+=l,f.x+=c)this.line(u.x,u.y,f.x,u.y,a,s);for(f=h;o.y>=u.y;u.y++,f.y++,u.x+=l,f.x+=d)this.line(u.x,u.y,f.x,u.y,a,s)}else{for(;h.y>=u.y;u.y++,f.y++,u.x+=c,f.x+=l)this.line(u.x,u.y,f.x,u.y,a,s);for(u=h;o.y>=u.y;u.y++,f.y++,u.x+=d,f.x+=l)this.line(u.x,u.y,f.x,u.y,a,s)}}imageToRam(t,e){let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let a=i.getContext("2d");a.drawImage(t,0,0);var s=a.getImageData(0,0,WIDTH,HEIGHT);let r=new Uint32Array(s.data.buffer);for(var n=0;r.length>n;n++)ram[e+n]=colors.indexOf(r[n])}render(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.c.width=this.c.width,this.ctx.putImageData(this.imageData,0,0)}textLine(t){let e=t[0].length;for(var i=0;e>i;i++){let e=this.getCharacter(t[0].charAt(i));for(var a=0;5>a;a++)for(var s=0;5>s;s++)1==e[5*a+s]&&(1==t[4]?this.pset(t[1]+s*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[5]):this.fillRect(t[1]+s*t[4]+(5*t[4]+t[3])*i,t[2]+a*t[4]|0,t[4],t[4],t[5]))}}text(t){let e=5*t[7],i=t[0].split("\n"),a=i.slice(0),s=i.length,r=a.sort((t,e)=>e.length-t.length)[0],n=r.length*e+(r.length-1)*t[3],h=s*e+(s-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var o=t[1],c=t[2],l=t[1]+n,d=t[2]+h;"center"==t[5]?(o=t[1]-n/2,l=t[1]+n/2):"right"==t[5]&&(o=t[1]-n,l=t[1]),"center"==t[6]?(c=t[2]-h/2,d=t[2]+h/2):"bottom"==t[6]&&(c=t[2]-h,d=t[2]);for(var u=o+n/2,f=c+h/2,m=0;s>m;m++){let a=i[m],s=a.length*e+(a.length-1)*t[3],r=t[1],n=t[2]+(e+t[4])*m;"center"==t[5]?r=t[1]-s/2:"right"==t[5]&&(r=t[1]-s),"center"==t[6]?n-=h/2:"bottom"==t[6]&&(n-=h),this.textLine([a,r,n,t[3],t[7],t[8]])}return{sx:o,sy:c,cx:u,cy:f,ex:l,ey:d,width:n,height:h}}getCharacter(t){let e=this.fontString.indexOf(t);return this.fontBitmap.substring(25*e,25*e+25).split("")}}var i=function(){var t,e,i,a,s,r=t=>Math.sin(6.283184*t),n=t=>.003959503758*2**((t-128)/12),h=(t,e,i)=>{var a,s,r,h,c,l,d=o[t.i[0]],u=t.i[1],f=t.i[3]/32,m=o[t.i[4]],p=t.i[5],y=t.i[8]/32,w=t.i[9],x=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,E=1/v,I=-t.i[13]/16,T=t.i[14],A=i*2**(2-t.i[15]),D=new Int32Array(x+g+v),C=0,M=0;for(a=0,s=0;x+g+v>a;a++,s++)0>s||(s-=A,c=n(e+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),l=n(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,x>a?r=a/x:x+g>a||(r=(1-(r=(a-x-g)*E))*3**(I*r)),h=d(C+=c*r**f)*u,h+=m(M+=l*r**y)*p,w&&(h+=(2*Math.random()-1)*w),D[a]=80*h*r|0;return D},o=[r,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=r=>{t=r,i=0,a=r.rowLen*r.patternLen*((e=r.endPattern)+1)*2,s=new Int32Array(a)},this.generate=()=>{var n,c,l,d,u,f,m,p,y,w,x,g,v,E,I=new Int32Array(a),T=t.songData[i],A=t.rowLen,D=t.patternLen,C=0,M=0,b=!1,H=[];for(l=0;e>=l;++l)for(m=T.p[l],d=0;D>d;++d){var S=m?T.c[m-1].f[d]:0;S&&(T.i[S-1]=T.c[m-1].f[d+D]||0,17>S&&(H=[]));var G=o[T.i[16]],W=T.i[17]/512,R=2**(T.i[18]-9)/A,L=T.i[19],P=T.i[20],z=135.82764118168*T.i[21]/44100,k=1-T.i[22]/255,N=1e-5*T.i[23],O=T.i[24]/32,Z=T.i[25]/512,X=6.283184*2**(T.i[26]-9)/A,U=T.i[27]/255,B=T.i[28]*A&-2;for(x=(l*D+d)*A,u=0;4>u;++u)if(f=m?T.c[m-1].n[d+u*D]:0){H[f]||(H[f]=h(T,f,A));var Y=H[f];for(c=0,n=2*x;Y.length>c;c++,n+=2)I[n]+=Y[c]}for(c=0;A>c;c++)(w=I[p=2*(x+c)])||b?(g=z,L&&(g*=G(R*p)*W+.5),M+=(g=1.5*Math.sin(g))*(v=k*(w-M)-(C+=g*M)),w=3==P?M:1==P?v:C,N&&(w=1>(w*=N)?w>-1?r(.25*w):-1:1,w/=N),b=(w*=O)*w>1e-5,E=w*(1-(y=Math.sin(X*p)*Z+.5)),w*=y):E=0,B>p||(E+=I[p-B+1]*U,w+=I[p-B]*U),I[p]=0|E,I[p+1]=0|w,s[p]+=0|E,s[p+1]+=0|w}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,a/2,44100),i=0;2>i;i++)for(var r=e.getChannelData(i),n=i;a>n;n+=2)r[n>>1]=s[n]/65536;return e},this.createWave=()=>{var t=44+2*a-8,e=t-36,i=new Uint8Array(44+2*a);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,n=44;a>r;++r){var h=s[r];i[n++]=255&(h=-32767>h?-32767:h>32767?32767:h),i[n++]=h>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),a=Array(e),r=0;2*e>r;r+=1){var n=i+r;a[r]=t>0&&s.length>n?s[n]/32768:0}return a}};class a{constructor(t,e,i,a){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=a}draw(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]}update(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)}}function s(t,e){return Math.floor(Math.random()*(e+1-t)+t)}function n(t){return t[s(0,t.length-1)]}function o(t,e=1,i=0,a=.5,s=!1){var r=window.audioCtx.createBufferSource(),n=window.audioCtx.createGain(),h=window.audioCtx.createStereoPanner();return r.buffer=t,r.connect(h),h.connect(n),n.connect(audioMaster),r.playbackRate.value=e,r.loop=s,n.gain.value=a,h.pan.value=i,r.start(),{volume:n,sound:r}}const c={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,q:81,r:82,m:77,h:72,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};var l={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1},d={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,55,6],p:[1],c:[{n:[151,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154,154,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,135],f:[]}]}],rowLen:6014,patternLen:32,endPattern:0,numChannels:1};function u(t,e,i,a){var{cos:s,sin:r}=Math,n=s(e),h=r(e),o=s(a),c=r(a),l=s(-i),d=r(-i);return{x:n*o*t.x+(n*c*d-h*l)*t.y+(n*c*l+h*d)*t.z,y:h*o*t.x+(h*c*d+n*l)*t.y+(h*c*l-n*d)*t.z,z:-c*t.x+o*d*t.y+o*l*t.z}}function f(t,e,i,a){var s,r,{cos:n,sin:h,sqrt:o,atan2:c}=Math;e-=a.camY,s=c(t-=a.camX,i-=a.camZ),r=o(t*t+i*i),t=h(s-a.yaw)*r,s=c(e,i=n(s-a.yaw)*r),r=o(e*e+i*i),e=h(s-a.pitch)*r;var l=200*((i=n(s-a.pitch)*r)-0)-0*(t-0),d=(1*(t-0)- -100*(i-0))/l,u=200/l;return d>0&&1>d&&u>0&&1>u?{x:a.cx+(200*d-100)*a.scale,y:a.cy+e/i*a.scale,d:o(t*t+e*e+i*i)}:{d:-1}}function m(t,e,i){this.x=t,this.y=e,this.z=i}const p={CIRCLE:0,SQUARE:1,POINT:2,TRIANGLES:3,SPRITE:4};class g{constructor(t,e,i,a={fill:{color1:22,color2:0,pattern:r.dither[0]},shape:p.point,size:1,angle:0,triangles:[]}){this.vert=new m(t,e,i),this.size=a.size,this.shape=a.shape,this.fill=a.fill,this.triangles=a.triangles,this.angle=a.angle}draw(t){let e=f(this.vert.x,this.vert.y,this.vert.z,t);if(-1!=e.d&&500>e.d){let{x:i,y:a}=e,s=this.size,n=this.shape,h=this.fill,{color1:o,color2:c,pattern:l}=h,d=s*(40/e.d);if(1>d&&3!=n)return;switch(r.cursorColor2=c,r.pat=l,n){case 0:1>d?r.pset(i,a,this.fill.stroke?this.fill.stroke:o,e.d):(r.fillCircle(i,a,d,o,e.d),r.pat=r.dither[0],this.fill.stroke&&r.circle(i,a,d,this.fill.stroke,e.d));break;case 1:r.fillRect(i-d/2,a-d/2,d,d,o,e.d),this.fill.stroke&&r.rect(i-d/2,a-d/2,d,d,this.fill.stroke,e.d);break;case 2:r.pset(i,a,o,e.d);break;case 3:let n=[];for(let e=0;this.triangles.length>e;e++){let i=this.triangles[e],a=this.vert,r=[];for(let e=0;i.points.length>e;e++){let n=i.points[e];n=u(n,this.angle,0,0);let h=f(n.x*s+a.x,n.y*s+a.y,a.z,t);-1!=h.d&&500>h.d&&r.push(h)}3==r.length&&(r.color=i.color,n.push(r))}for(let t=0;n.length>t;t++){let i=n[t];r.fillTriangle(i[0],i[1],i[2],i.color,e.d),this.fill.stroke&&r.fillTriangle(x1,y1,x2,y2,x3,y3,this.fill.stroke,e.d)}}r.cursorColor2=64,r.pat=r.dither[0]}}}class v{constructor(t,e,i,a){this.location=new m(t,e,i),this.splats=a,this.splats.forEach(t=>{t.vert.x+=this.location.x,t.vert.y+=this.location.y,t.vert.z+=this.location.z})}}800>innerWidth?(screenFactor=2,w=innerWidth/2,h=innerHeight/2):(screenFactor=4,w=Math.floor(innerWidth/4),h=Math.floor(innerHeight/4)),view={x:0,y:0,z:0},camera={},cursor={x:0,y:0,isDown:!1},viewTarget={x:0,y:0},then=0,elapsed=0,now=0,framesPerSecond=60,fpsInterval=1e3/60,window.t=1,splodes=[],splatShapes=[],window.lines=[],window.player=new class{constructor(t,e,i=0){this.x=t,this.y=e,this.z=i,this.width=8,this.height=8,this.speed={x:2,y:2},this.velocity={x:0,y:0},this.drag={x:.8,y:.8},this.target={x:0,y:0,distance:0},this.alive=!0}draw(){r.fillCircle(this.x-view.x,this.y-view.y+5*Math.sin(t/10),this.width/2,22)}update(){this.x+=this.velocity.x,this.y+=this.velocity.y;let e=this.target.x-this.x,i=this.target.y-this.y;return this.target.distance=Math.sqrt(e*e+i*i),5>this.target.distance&&(this.velocity.x*=this.drag.x,this.velocity.y*=this.drag.y),splodes.push(new a(this.x,this.y+7*Math.sin(t/10),s(5,10),s(18,22))),0}move(t,e){this.target.x=t,this.target.y=e;let i=Math.atan2(this.target.y-this.y,this.target.x-this.x);this.velocity.x=Math.cos(i)*this.speed.x,this.velocity.y=Math.sin(i)*this.speed.y}}(100,100),gamestate=0,paused=!1,started=!1,sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="";const E=w/2,I=h/2,T=document.createElement("style");function A(){(()=>{for(let t=0;6.25>t;t++){let e=[];for(let t=0;24>t;t++){let i=42,a=2*Math.PI/24,h=n([1,31,32]),o=new g(Math.sin(a*t)*i,Math.cos(a*t)*i,t%2==0?0:40,{size:7.6,shape:3,fill:{color1:0,color2:n[1],pattern:r.dither[s(0,8)]},angle:2*Math.PI*(-t/24),triangles:[{points:[{x:-1,y:-1,z:0},{x:1,y:-1,z:0},{x:-1.6,y:1,z:0}],color:h},{points:[{x:-1.6,y:1,z:0},{x:1,y:-1,z:0},{x:1.6,y:1,z:0}],color:h}]});e.push(o)}splatShapes.push(new v(0,0,80*t,e))}let t=[];for(let e=0;1e3>e;e++){let e=6.283185307179586*Math.random()+0,i=44,a=new m(Math.sin(e)*i,Math.cos(e)*i,500/60*s(0,60)+s(0,20)),h=new g(a.x,a.y,a.z,{fill:{color1:n([1,31]),color2:n([1,31]),pattern:r.dither[n([7,8])]},shape:0,size:s(15,30)});t.push(h)}splatShapes.push(new v(0,0,0,t))})(),camera={camX:0,camY:0,camZ:-10,pitch:0,yaw:0,cx:E,cy:I,scale:300}}function D(){requestAnimationFrame(D),now=Date.now(),elapsed=now-then,elapsed>1e3/60&&(then=now-elapsed%(1e3/60),(()=>{switch(gamestate){case 0:r.clr(0,r.SCREEN),r.text([audioTxt,w/2-2,100,1,3,"center","top",1,22]),audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds?audioTxt="ALL SOUNDS RENDERED.\nTAP OR CLICK TO CONTINUE":started?audioTxt="SOUNDS RENDERING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",cursor.isDown&&soundsReady==totalSounds&&(gamestate=3,cursor.isDown=!1),r.render();break;case 3:(()=>{if(t+=1,splatShapes.forEach(t=>{t.splats.forEach(t=>{t.vert.z-=7,-10>t.vert.z&&(t.vert.z=500)})}),(t=>{for(let e=0;t.length>e;e++)t[e].alive||t.splice(e,1)})(splodes),c.justReleased(c.r)&&(window.t=1,splodes=[],A(),gamestate=3),c.isDown(c.w)){let t=1;camera.camX+=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ+=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY+=Math.sin(camera.pitch)*t}if(c.isDown(c.s)){let t=1;camera.camX-=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ-=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY-=Math.sin(camera.pitch)*t}if(c.isDown(c.a)){let t=1;camera.camX-=1*Math.cos(-camera.yaw)*t,camera.camZ-=1*Math.sin(-camera.yaw)*t,camera.camY-=0*t}if(c.isDown(c.d)){let t=1;camera.camX+=1*Math.cos(-camera.yaw)*t,camera.camZ+=1*Math.sin(-camera.yaw)*t,camera.camY+=0*t}c.isDown(c.UP)&&(camera.pitch+=.01),c.isDown(c.DOWN)&&(camera.pitch-=.01),c.isDown(c.LEFT)&&(camera.yaw-=.01),c.isDown(c.RIGHT)&&(camera.yaw+=.01);let e=0>camera.camZ?"NEG "+camera.camZ:camera.camZ;debugtxt=`X ${camera.camX.toFixed(3)}\nY ${camera.camY}\nZ ${e}\nPITCH ${camera.pitch}\nYAW ${camera.yaw}`})(),r.clr(0,r.SCREEN),r.pat=r.dither[14],r.cursorColor2=0,r.fillRect(0,0,w,h,1,9999),r.cursorColor2=64,r.pat=r.dither[0],splatShapes.forEach(t=>{t.splats.forEach(t=>t.draw(camera))}),lines.forEach(t=>t.draw(camera)),r.text([debugtxt,10,10,1,3,"left","top",1,22]),r.render();break;case 2:(()=>{r.clr(0,r.SCREEN);let t="THE WELL";r.text([t,w/2-2,100,2,3,"center","top",3,22]),t="CLICK TO BEGIN",r.text([t,w/2-2,120,1,3,"center","top",1,22]),r.render()})()}})()),c.update()}T.type="text/css",T.innerText="\n  canvas {display: inline-block; height:100%; width:100%;  image-rendering: pixelated;\n    image-rendering: crisp-edges; background-color: black;}\n\n  * {\n    overflow: hidden;\n    background-color: black;\n    margin: 0;\n    }\n",document.head.appendChild(T),atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRgYBAABXRUJQVlA4TPkAAAAvPwAAAAmAIPx/e4jof2oBEIT/bw8R/U/BbQAAZBPbrG0bm77naNt2L3FjAQCpfJvZtdk21m7QhbpU769xtW3XZicCAJBRmm1G6wHry3sBv3oJ2TaTzQgMgykOw60sEIPJ/NfmfEb0m+KfSWGWH/i/u8auMllLp0n52cfoLvVtXVYKFAcUZfWj5j87X4mHi8bzX1l8HrX3pPYcTlvOVVr9qo3Lavb/rXmB1LJcpoDHLXpMG3GbpNff9Hvj+WI8GbdW+8mBP7FawBlU3S655I2Sr7TX+Qybu3urf71W96O6lRfDTjcaDs1JZ6CujZezdr8z65838/1hdwAA",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),window.r=new e(w,h,atlas,10),window.playSound=o,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),D()},window.addEventListener("keyup",t=>{c.onKeyup(t)},!1),window.addEventListener("keydown",t=>{c.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),window.addEventListener("mousemove",()=>{},!1),window.addEventListener("mousedown",()=>{cursor.isDown=!0},!1),window.addEventListener("mouseup",()=>{cursor.isDown=!1},!1),window.addEventListener("touchstart",t=>{0==gamestate?onWindowInteraction(t):cursor.isDown=!0},!1),window.addEventListener("touchend",()=>{cursor.isDown=!1},!1),onWindowInteraction=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0!=soundsReady||started||(A(),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),compressor=audioCtx.createDynamicsCompressor(),compressor.threshold.setValueAtTime(-60,audioCtx.currentTime),compressor.knee.setValueAtTime(40,audioCtx.currentTime),compressor.ratio.setValueAtTime(12,audioCtx.currentTime),compressor.attack.setValueAtTime(0,audioCtx.currentTime),compressor.release.setValueAtTime(.25,audioCtx.currentTime),audioMaster.connect(compressor),compressor.connect(audioCtx.destination),sndData=[{name:"cellComplete",data:l},{name:"tada",data:d}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{const e=new i;e.init(t.data);let a=!1;setInterval(()=>{if(!a&&(a=1==e.generate(),soundsReady+=a,a)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)}),started=!0);break;case 2:gamestate=3;break;case 3:break;case GAMEOVER:}},onclick=t=>{onWindowInteraction(t)},ontouchstart=t=>{onWindowInteraction(t)}}();
