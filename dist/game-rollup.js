!function(){class e{constructor(t,e,i,r){this.WIDTH=t,this.HEIGHT=e,this.PAGESIZE=this.WIDTH*this.HEIGHT,this.PAGES=r,this.atlas=i,this.SCREEN=0,this.PAGE_1=this.PAGESIZE,this.PAGE_2=2*this.PAGESIZE,this.PAGE_3=3*this.PAGESIZE,this.PAGE_4=4*this.PAGESIZE,this.cursorX=0,this.cursorY=0,this.cursorColor=22,this.cursorColor2=64,this.stencil=!1,this.stencilSource=this.PAGE_2,this.stencilOffset=0,this.colors=this.atlas.slice(0,64),this.palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],this.c=document.createElement("canvas"),this.c.width=this.WIDTH,this.c.height=this.HEIGHT,this.ctx=this.c.getContext("2d"),this.renderTarget=0,this.renderSource=this.PAGESIZE,this.fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",this.fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",this.pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],this.dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0,63903,1632,63624],this.pat=65535,this.ctx.imageSmoothingEnabled=!1,this.imageData=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8Array(this.buf),this.data=new Uint32Array(this.buf),this.ram=new Uint8Array(this.WIDTH*this.HEIGHT*this.PAGES),this.zbuf=new Float64Array(this.WIDTH*this.HEIGHT)}setPen(t,e,i=0){this.cursorColor=t,this.cursorColor2=e,this.pat=i}clr(t,e){this.ram.fill(t,e,e+this.PAGESIZE),this.zbuf.fill(99999999,0,this.WIDTH*this.HEIGHT)}pset(t,e,i,r=0){if(0>t|t>this.WIDTH-1)return;if(0>e|e>this.HEIGHT-1)return;if(r>this.zbuf[e*this.WIDTH+t])return;t|=0,e|=0,i=this.stencil?this.pget(t,e,this.stencilSource)+this.stencilOffset:(0|i)%64;let s=this.pat&Math.pow(2,e%4*4+t%4)?i:this.cursorColor2;64!=s&&(this.ram[this.renderTarget+e*this.WIDTH+t]=s,this.zbuf[e*this.WIDTH+t]=r)}pget(t,e,i=0){return this.ram[i+(t|=0)+(e|=0)*this.WIDTH]}line(t,e,i,r,s,a=0){var n,o,h=(r|=0)-(e|=0),c=(i|=0)-(t|=0);if(0>h?(h=-h,o=-1):o=1,0>c?(c=-c,n=-1):n=1,h<<=1,c<<=1,this.pset(t,e,s,a),c>h)for(var l=h-(c>>1);t!=i;)0>l||(e+=o,l-=c),l+=h,this.pset(t+=n,e,s,a);else for(l=c-(h>>1);e!=r;)0>l||(t+=n,l-=h),l+=c,this.pset(t,e+=o,s,a)}tline(t,e,i,r,s=0,a=0,n=0,o=0){var h,c,l=(r|=0)-(e|=0),d=(i|=0)-(t|=0);0>l?(l=-l,c=-1):c=1,0>d?(d=-d,h=-1):h=1;for(var u=t,f=e,p=(l<<=1)-((d<<=1)>>1);u!=i;)0>p||(f+=c,p-=d),p+=l,this.pset(u+=h,f,this.pget(u-s,f-a,this.renderSource)+n)}circle(t,e,i,r,s=0){t|=0,e|=0,r|=0;var a=-(i|=0),n=0,o=2-2*i;do{this.pset(t-a,e+n,r,s),this.pset(t-n,e-a,r,s),this.pset(t+a,e-n,r,s),this.pset(t+n,e+a,r,s),(i=o)>n||(o+=2*++n+1),(i>a||o>n)&&(o+=2*++a+1)}while(0>a)}fillCircle(t,e,i,r,s=0){if(t|=0,e|=0,r|=0,(i|=0)>=0){t|=0,e|=0;var a=-(i|=0),n=0,o=2-2*i;do{this.line(t-a,e-n,t+a,e-n,r,s),this.line(t-a,e+n,t+a,e+n,r,s),(i=o)>n||(o+=2*++n+1),(i>a||o>n)&&(o+=2*++a+1)}while(0>a)}}tfillCircle(t,e,i,r=0,s=0){if(t|=0,e|=0,i|=0,offX=t-mw,offY=e-mh,i>=0){t|=0,e|=0;var a=-(i|=0),n=0,o=2-2*i;do{this.tline(t-a,e-n,t+a,e-n,offX,offY,r,s),this.tline(t-a,e+n,t+a,e+n,offX,offY,r,s),(i=o)>n||(o+=2*++n+1),(i>a||o>n)&&(o+=2*++a+1)}while(0>a)}}rect(t,e,i,r,s,a=0){let n=0|t,o=0|e,h=t+i|0,c=e+r|0;this.line(n,o,h,o,s,a),this.line(h,o,h,c,s,a),this.line(n,c,h,c,s,a),this.line(n,o,n,c,s,a)}fillRect(t,e,i,r,s,a=0){let n=0|t,o=0|e,h=(t+i|0)-1,c=(e+r|0)-1;s=s;var l=Math.abs(c-o);if(this.line(n,o,h,o,s,a),l>0)for(;--l;)this.line(n,o+l,h,o+l,s,a);this.line(n,c,h,c,s,a)}sspr(t=0,e=0,i=16,r=16,s=0,a=0,n=32,o=32,h=!1,c=!1,l=0){var d=i/n,u=r/o;this.pat=this.dither[0];for(var f=0;o>f;f++)for(var p=0;n>p;p++)px=p*d|0,py=f*u|0,e=c?r-py-f:e,t=h?i-px-p:t,source=this.pget(t+px,e+py,this.renderSource),source>0&&this.pset(s+p,a+f,source)}outline(t,e,i,r,s,a){for(let t=0;this.WIDTH>=t;t++)for(let e=0;this.HEIGHT>=e;e++){let n=t-1+e*this.WIDTH,o=t+1+e*this.WIDTH,h=t+(e+1)*this.WIDTH,c=t+(e-1)*this.WIDTH;this.ram[this.renderSource+(t+e*this.WIDTH)]&&(64==this.ram[this.renderSource+n]&&(this.ram[this.renderTarget+n]=i),64==this.ram[this.renderSource+o]&&(this.ram[this.renderTarget+o]=s),64==this.ram[this.renderSource+c]&&(this.ram[this.renderTarget+c]=r),64==this.ram[this.renderSource+h]&&(this.ram[this.renderTarget+h]=a))}}triangle(t,e,i,r,s=0){this.line(t.x,t.y,e.x,e.y,r),this.line(e.x,e.y,i.x,i.y,r),this.line(i.x,i.y,t.x,t.y,r)}strokePolygon(t,e,i,r,s=0,a="white"){r=r||Math.floor(240*i)+16;for(let n=0;r>n;n++){let o=n/r*6.283185,h=(n+1)/r*6.283185;this.line(t+Math.cos(o+s)*i,e+Math.sin(o+s)*i,t+Math.cos(h+s)*i,e+Math.sin(h+s)*i,a)}}fillTriangle(t,e,i,r){let s=[Object.assign({},t),Object.assign({},e),Object.assign({},i)].sort((t,e)=>t.y-e.y),a=s[0],n=s[1],o=s[2],h=0,c=0,l=0,d={},u={};if(n.y-a.y>0&&(h=(n.x-a.x)/(n.y-a.y)),o.y-a.y>0&&(c=(o.x-a.x)/(o.y-a.y)),o.y-n.y>0&&(l=(o.x-n.x)/(o.y-n.y)),Object.assign(d,a),Object.assign(u,a),h>c){for(;n.y>=d.y;d.y++,u.y++,d.x+=c,u.x+=h)this.line(d.x,d.y,u.x,d.y,r);for(u=n;o.y>=d.y;d.y++,u.y++,d.x+=c,u.x+=l)this.line(d.x,d.y,u.x,d.y,r)}else{for(;n.y>=d.y;d.y++,u.y++,d.x+=h,u.x+=c)this.line(d.x,d.y,u.x,d.y,r);for(d=n;o.y>=d.y;d.y++,u.y++,d.x+=l,u.x+=c)this.line(d.x,d.y,u.x,d.y,r)}}imageToRam(t,e){let i=document.createElement("canvas");i.width=WIDTH,i.height=HEIGHT;let r=i.getContext("2d");r.drawImage(t,0,0);var s=r.getImageData(0,0,WIDTH,HEIGHT);let a=new Uint32Array(s.data.buffer);for(var n=0;a.length>n;n++)ram[e+n]=colors.indexOf(a[n])}render(){for(var t=this.PAGESIZE;t--;)t>0&&(this.data[t]=this.colors[this.pal[this.ram[t]]]);this.imageData.data.set(this.buf8),this.c.width=this.c.width,this.ctx.putImageData(this.imageData,0,0)}textLine(t){let e=t[0].length;for(var i=0;e>i;i++){let e=this.getCharacter(t[0].charAt(i));for(var r=0;5>r;r++)for(var s=0;5>s;s++)1==e[5*r+s]&&(1==t[4]?this.pset(t[1]+s*t[4]+(5*t[4]+t[3])*i,t[2]+r*t[4]|0,t[5]):this.fillRect(t[1]+s*t[4]+(5*t[4]+t[3])*i,t[2]+r*t[4]|0,t[4],t[4],t[5]))}}text(t){let e=5*t[7],i=t[0].split("\n"),r=i.slice(0),s=i.length,a=r.sort((t,e)=>e.length-t.length)[0],n=a.length*e+(a.length-1)*t[3],o=s*e+(s-1)*t[4];t[5]||(t[5]="left"),t[6]||(t[6]="bottom");var h=t[1],c=t[2],l=t[1]+n,d=t[2]+o;"center"==t[5]?(h=t[1]-n/2,l=t[1]+n/2):"right"==t[5]&&(h=t[1]-n,l=t[1]),"center"==t[6]?(c=t[2]-o/2,d=t[2]+o/2):"bottom"==t[6]&&(c=t[2]-o,d=t[2]);for(var u=h+n/2,f=c+o/2,p=0;s>p;p++){let r=i[p],s=r.length*e+(r.length-1)*t[3],a=t[1],n=t[2]+(e+t[4])*p;"center"==t[5]?a=t[1]-s/2:"right"==t[5]&&(a=t[1]-s),"center"==t[6]?n-=o/2:"bottom"==t[6]&&(n-=o),this.textLine([r,a,n,t[3],t[7],t[8]])}return{sx:h,sy:c,cx:u,cy:f,ex:l,ey:d,width:n,height:o}}getCharacter(t){let e=this.fontString.indexOf(t);return this.fontBitmap.substring(25*e,25*e+25).split("")}}var i=function(){var t,e,i,r,s,a=t=>Math.sin(6.283184*t),n=t=>.003959503758*2**((t-128)/12),o=(t,e,i)=>{var r,s,a,o,c,l,d=h[t.i[0]],u=t.i[1],f=t.i[3]/32,p=h[t.i[4]],m=t.i[5],w=t.i[8]/32,y=t.i[9],x=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,v=t.i[12]*t.i[12]*4,E=1/v,I=-t.i[13]/16,T=t.i[14],C=i*2**(2-t.i[15]),A=new Int32Array(x+g+v),D=0,M=0;for(r=0,s=0;x+g+v>r;r++,s++)0>s||(s-=C,c=n(e+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),l=n(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),a=1,x>r?a=r/x:x+g>r||(a=(1-(a=(r-x-g)*E))*3**(I*a)),o=d(D+=c*a**f)*u,o+=p(M+=l*a**w)*m,y&&(o+=(2*Math.random()-1)*y),A[r]=80*o*a|0;return A},h=[a,t=>.5>t%1?1:-1,t=>t%1*2-1,t=>{var e=t%1*4;return 2>e?e-1:3-e}];this.init=a=>{t=a,i=0,r=a.rowLen*a.patternLen*((e=a.endPattern)+1)*2,s=new Int32Array(r)},this.generate=()=>{var n,c,l,d,u,f,p,m,w,y,x,g,v,E,I=new Int32Array(r),T=t.songData[i],C=t.rowLen,A=t.patternLen,D=0,M=0,H=!1,S=[];for(l=0;e>=l;++l)for(p=T.p[l],d=0;A>d;++d){var b=p?T.c[p-1].f[d]:0;b&&(T.i[b-1]=T.c[p-1].f[d+A]||0,17>b&&(S=[]));var G=h[T.i[16]],R=T.i[17]/512,W=2**(T.i[18]-9)/C,P=T.i[19],L=T.i[20],k=135.82764118168*T.i[21]/44100,N=1-T.i[22]/255,O=1e-5*T.i[23],z=T.i[24]/32,X=T.i[25]/512,Z=6.283184*2**(T.i[26]-9)/C,U=T.i[27]/255,Y=T.i[28]*C&-2;for(x=(l*A+d)*C,u=0;4>u;++u)if(f=p?T.c[p-1].n[d+u*A]:0){S[f]||(S[f]=o(T,f,C));var B=S[f];for(c=0,n=2*x;B.length>c;c++,n+=2)I[n]+=B[c]}for(c=0;C>c;c++)(y=I[m=2*(x+c)])||H?(g=k,P&&(g*=G(W*m)*R+.5),M+=(g=1.5*Math.sin(g))*(v=N*(y-M)-(D+=g*M)),y=3==L?M:1==L?v:D,O&&(y=1>(y*=O)?y>-1?a(.25*y):-1:1,y/=O),H=(y*=z)*y>1e-5,E=y*(1-(w=Math.sin(Z*m)*X+.5)),y*=w):E=0,Y>m||(E+=I[m-Y+1]*U,y+=I[m-Y]*U),I[m]=0|E,I[m+1]=0|y,s[m]+=0|E,s[m+1]+=0|y}return++i/t.numChannels},this.createAudioBuffer=t=>{for(var e=t.createBuffer(2,r/2,44100),i=0;2>i;i++)for(var a=e.getChannelData(i),n=i;r>n;n+=2)a[n>>1]=s[n]/65536;return e},this.createWave=()=>{var t=44+2*r-8,e=t-36,i=new Uint8Array(44+2*r);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var a=0,n=44;r>a;++a){var o=s[a];i[n++]=255&(o=-32767>o?-32767:o>32767?32767:o),i[n++]=o>>8&255}return i},this.getData=(t,e)=>{for(var i=2*Math.floor(44100*t),r=Array(e),a=0;2*e>a;a+=1){var n=i+a;r[a]=t>0&&s.length>n?s[n]/32768:0}return r}};class s{constructor(t,e,i,r){this.x=t,this.y=e,this.lifeMax=i,this.life=i,this.alive=!0,this.color=r}draw(){r.pat=r.dither[15-Math.floor(this.life/this.lifeMax*15)];for(let t=Math.floor(this.life/10);t>0;t--)r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life-t,this.color);r.circle(this.x-view.x,this.y-view.y,this.lifeMax-this.life,this.color),r.pat=r.dither[0]}update(){this.alive&&(this.life>0?this.life-=1:this.alive=!1)}}function a(t,e){return Math.floor(Math.random()*(e+1-t)+t)}function n(t,e){return Math.random()*(e-t)+t}function o(t){return t[a(0,t.length-1)]}function c(t,e=1,i=0,r=.5,s=!1){var a=window.audioCtx.createBufferSource(),n=window.audioCtx.createGain(),o=window.audioCtx.createStereoPanner();return a.buffer=t,a.connect(o),o.connect(n),n.connect(audioMaster),a.playbackRate.value=e,a.loop=s,n.gain.value=r,o.pan.value=i,a.start(),{volume:n,sound:a}}const l={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,q:81,r:82,m:77,h:72,isDown(t){return this._pressed[t]},justReleased(t){return this._released[t]},onKeydown(t){this._pressed[t.keyCode]=!0},onKeyup(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update(){this._released={}}};var d={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,28,6],p:[1],c:[{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]}],rowLen:5088,patternLen:32,endPattern:0,numChannels:1},u={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,55,6],p:[1],c:[{n:[151,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154,154,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,135],f:[]}]}],rowLen:6014,patternLen:32,endPattern:0,numChannels:1};function f(t,e,i){this.x=t,this.y=e,this.z=i}const p={CIRCLE:0,SQUARE:1,POINT:2};class m{constructor(t,e,i,s={fill:{color1:22,color2:0,pattern:r.dither[0]},shape:p.point,size:1}){this.vert=new f(t,e,i),this.size=s.size,this.shape=s.shape,this.fill=s.fill}draw(t){let e=((t,e,i,r)=>{var s,a,{cos:n,sin:o,sqrt:h,atan2:c}=Math;e-=r.camY,s=c(t-=r.camX,i-=r.camZ),a=h(t*t+i*i),t=o(s-r.yaw)*a,s=c(e,i=n(s-r.yaw)*a),a=h(e*e+i*i),e=o(s-r.pitch)*a;var l=200*((i=n(s-r.pitch)*a)-0)-0*(t-0),d=(1*(t-0)- -100*(i-0))/l,u=200/l;return d>0&&1>d&&u>0&&1>u?{x:r.cx+(200*d-100)*r.scale,y:r.cy+e/i*r.scale,d:h(t*t+e*e+i*i)}:{d:-1}})(this.vert.x,this.vert.y,this.vert.z,t);if(-1!=e.d&&2e3>e.d){var{x:i,y:s}=e,a=this.size,n=this.shape,o=this.fill,{color1:h,color2:c,pattern:l}=o;e.d>1800&&(h=2),e.d>1975&&(c=2,h=1);var d=a*(40/e.d);0==n?(r.cursorColor2=c,r.pat=l,1>d?r.pset(i,s,h,e.d):(r.fillCircle(i,s,d,h,e.d),r.pat=r.dither[0],this.fill.stroke&&r.circle(i,s,d,this.fill.stroke,e.d)),r.cursorColor2=64,r.pat=r.dither[0]):1==n?(r.cursorColor2=c,r.pat=l,r.fillRect(i-d/2,s-d/2,d,d,h,e.d),this.fill.stroke&&r.rect(i-d/2,s-d/2,d,d,this.fill.stroke,e.d)):2==n&&(r.pat=l,r.pset(i,s,h,e.d)),r.cursorColor2=64,r.pat=r.dither[0]}}}class g{constructor(t,e,i,r){this.location=new f(t,e,i),this.splats=r}}800>innerWidth?(screenFactor=2,w=innerWidth/2,h=innerHeight/2):(screenFactor=3,w=Math.floor(innerWidth/3),h=Math.floor(innerHeight/3)),view={x:0,y:0,z:0},camera={},cursor={x:0,y:0,isDown:!1},viewTarget={x:0,y:0},then=0,elapsed=0,now=0,framesPerSecond=60,fpsInterval=1e3/60,window.t=1,splodes=[],fans=[],splats=[],window.splatShapes=[],window.player=new class{constructor(t,e,i=0){this.x=t,this.y=e,this.z=i,this.width=8,this.height=8,this.speed={x:2,y:2},this.velocity={x:0,y:0},this.drag={x:.8,y:.8},this.target={x:0,y:0,distance:0},this.alive=!0}draw(){r.fillCircle(this.x-view.x,this.y-view.y+5*Math.sin(t/10),this.width/2,22)}update(){this.x+=this.velocity.x,this.y+=this.velocity.y;let e=this.target.x-this.x,i=this.target.y-this.y;return this.target.distance=Math.sqrt(e*e+i*i),5>this.target.distance&&(this.velocity.x*=this.drag.x,this.velocity.y*=this.drag.y),splodes.push(new s(this.x,this.y+7*Math.sin(t/10),a(5,10),a(18,22))),0}move(t,e){this.target.x=t,this.target.y=e;let i=Math.atan2(this.target.y-this.y,this.target.x-this.x);this.velocity.x=Math.cos(i)*this.speed.x,this.velocity.y=Math.sin(i)*this.speed.y}}(100,100),screenCenterX=w/2,screenCenterY=h/2,gamestate=0,paused=!1,started=!1,sounds={},soundsReady=0,totalSounds=2,audioTxt="",debugText="";const v=document.createElement("style");function E(){let t=[],e=[{x:0,y:0,rad:100,colors:[16,17,19],quantity:2e3}];for(let t=0;10>t;t++){let t=n(0,2*Math.PI),i=200+n(0,300);e.push({x:Math.cos(t)*i,y:Math.sin(t)*i,rad:a(100,500),colors:[30,31,32],quantity:a(100,200)})}e.forEach(e=>{t=[];for(let i=0;e.quantity>i;i++){let s=e.rad,a=o(e.colors),h=o(e.colors),c=n(0,2*Math.PI),l=new f(e.x+Math.sin(c)*s,e.y+Math.cos(c)*s,-2e3/e.quantity*i),d=new m(l.x,l.y,l.z,{fill:{color1:a,color2:h,pattern:r.dither[8]},shape:0,size:n(7,15)});t.push(d)}splatShapes.push(new g(0,0,0,t))});let i=[];for(let t=0;25>t;t++){let e=n(0,2*Math.PI),s=50,o=new f(Math.sin(e)*s,Math.cos(e)*s,-80*t),h=new m(o.x,o.y,o.z,{fill:{color1:0,color2:1,stroke:19,pattern:r.dither[a(0,8)]},shape:0,size:a(30,70)});n(0,1)>.9&&(h.size=200,h.vert.x=150*Math.sin(e),h.vert.y=150*Math.cos(e),h.fill.stroke=16),i.push(h)}splatShapes.push(new g(0,0,0,i)),i=[];for(let t=0;900>t;t++){let t=n(0,2*Math.PI),e=50,s=new f(Math.sin(t)*e,Math.cos(t)*e,-500*a(0,3)+20*Math.random()),h=new m(s.x,s.y,s.z,{fill:{color1:o([0,41,42]),color2:o([0,41,42]),stroke:40,pattern:r.dither[a(0,8)]},shape:1,size:a(5,15)});n(0,1)>.98&&(h.size=a(80,120)),i.push(h)}splatShapes.push(new g(0,0,0,i)),camera={camX:0,camY:0,camZ:-2e3,pitch:0,yaw:0,cx:screenCenterX,cy:screenCenterY,scale:200}}function I(){requestAnimationFrame(I),now=Date.now(),elapsed=now-then,elapsed>1e3/60&&(then=now-elapsed%(1e3/60),(()=>{switch(gamestate){case 0:r.clr(0,r.SCREEN),r.text([audioTxt,w/2-2,100,1,3,"center","top",1,22]),audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",soundsReady==totalSounds?audioTxt="ALL SOUNDS RENDERED.\nTAP OR CLICK TO CONTINUE":started?audioTxt="SOUNDS RENDERING... "+soundsReady:audioTxt="CLICK TO INITIALIZE\nGENERATION SEQUENCE",cursor.isDown&&soundsReady==totalSounds&&(gamestate=1),r.render();break;case 1:(()=>{if(t+=1,splatShapes.forEach(t=>{t.splats.forEach(t=>{t.vert.z-=5,t.vert.z=t.vert.z%2e3})}),(t=>{for(let e=0;t.length>e;e++)t[e].alive||t.splice(e,1)})(splodes),viewTarget.x=player.x-screenCenterX,viewTarget.y=player.y-screenCenterY,view.y=(e=view.y)+.1*(viewTarget.y-e),l.justReleased(l.r)&&(window.t=1,splodes=[],E(),gamestate=1),l.isDown(l.w)){let t=5;camera.camX+=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ+=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY+=Math.sin(camera.pitch)*t}var e;if(l.isDown(l.s)){let t=5;camera.camX-=Math.sin(camera.yaw)*Math.cos(camera.pitch)*t,camera.camZ-=Math.cos(camera.yaw)*Math.cos(camera.pitch)*t,camera.camY-=Math.sin(camera.pitch)*t}l.isDown(l.UP)&&(camera.pitch+=.01),l.isDown(l.DOWN)&&(camera.pitch-=.01),l.isDown(l.LEFT)&&(camera.yaw-=.01),l.isDown(l.RIGHT)&&(camera.yaw+=.01);let i=0>camera.camZ?"NEG "+camera.camZ:camera.camZ;debugtxt=`X ${camera.camX.toFixed(3)}\nY ${camera.camY}\nZ ${i}\nPITCH ${camera.pitch}\nYAW ${camera.yaw}`})(),r.clr(1,r.SCREEN),splatShapes.forEach(t=>{t.splats.forEach(t=>t.draw(camera))}),r.text([debugtxt,10,10,1,3,"left","top",1,22]),r.render();break;case 2:(()=>{(l.justReleased(l.UP)||l.justReleased(l.w)||l.justReleased(l.z))&&(gamestate=1),r.clr(14,r.SCREEN);let t=Math.ceil(w/32),e=Math.ceil(h/32);for(let e=0;t>e;e++)r.line(32*e,0,32*e,r.HEIGHT,2);for(let t=0;e>t;t++)r.line(0,32*t,r.WIDTH,32*t,2);let i="TITLE SCREEN";r.text([i,w/2-2,100,2,3,"center","top",3,22]),i="CLICK TO BEGIN",r.text([i,w/2-2,120,1,3,"center","top",1,22]),r.render()})()}})()),l.update()}function T(t){let e=Math.floor(t.pageX/screenFactor),i=Math.floor(t.pageY/screenFactor)+view.y,r=e+view.x;cursor.isDown?splodes.push(new s(r,i,a(5,10),a(0,63))):player.move(r,i)}v.type="text/css",v.innerText="\n  canvas {display: inline-block; height:100%; width:100%;  image-rendering: pixelated;\n    image-rendering: crisp-edges; background-color: black;}\n\n  * {\n    overflow: hidden;\n    background-color: black;\n    margin: 0;\n    }\n",document.head.appendChild(v),atlasImage=new Image,atlasImage.src="data:image/webp;base64,UklGRgYBAABXRUJQVlA4TPkAAAAvPwAAAAmAIPx/e4jof2oBEIT/bw8R/U/BbQAAZBPbrG0bm77naNt2L3FjAQCpfJvZtdk21m7QhbpU769xtW3XZicCAJBRmm1G6wHry3sBv3oJ2TaTzQgMgykOw60sEIPJ/NfmfEb0m+KfSWGWH/i/u8auMllLp0n52cfoLvVtXVYKFAcUZfWj5j87X4mHi8bzX1l8HrX3pPYcTlvOVVr9qo3Lavb/rXmB1LJcpoDHLXpMG3GbpNff9Hvj+WI8GbdW+8mBP7FawBlU3S655I2Sr7TX+Qybu3urf71W96O6lRfDTjcaDs1JZ6CujZezdr8z65838/1hdwAA",atlasImage.onload=function(){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.drawImage(this,0,0),atlas=new Uint32Array(i.getImageData(0,0,64,64).data.buffer),window.r=new e(w,h,atlas,10),window.playSound=c,gamebox=document.getElementById("game"),gamebox.appendChild(r.c),I()},window.addEventListener("keyup",t=>{l.onKeyup(t)},!1),window.addEventListener("keydown",t=>{l.onKeydown(t)},!1),window.addEventListener("blur",()=>{paused=!0},!1),window.addEventListener("focus",()=>{paused=!1},!1),window.addEventListener("mousemove",t=>{cursor.isDown&&T(t)},!1),window.addEventListener("mousedown",t=>{cursor.isDown=!0,T(t)},!1),window.addEventListener("mouseup",t=>{cursor.isDown=!1,T(t)},!1),window.addEventListener("touchstart",t=>{0==gamestate?onWindowInteraction(t):(cursor.isDown=!0,T(t))},!1),window.addEventListener("touchend",()=>{cursor.isDown=!1},!1),onWindowInteraction=t=>{switch(x=t.pageX,y=t.pageY,paused=!1,gamestate){case 0:0!=soundsReady||started||(E(),audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),compressor=audioCtx.createDynamicsCompressor(),compressor.threshold.setValueAtTime(-60,audioCtx.currentTime),compressor.knee.setValueAtTime(40,audioCtx.currentTime),compressor.ratio.setValueAtTime(12,audioCtx.currentTime),compressor.attack.setValueAtTime(0,audioCtx.currentTime),compressor.release.setValueAtTime(.25,audioCtx.currentTime),audioMaster.connect(compressor),compressor.connect(audioCtx.destination),sndData=[{name:"cellComplete",data:d},{name:"tada",data:u}],totalSounds=sndData.length,soundsReady=0,sndData.forEach(t=>{const e=new i;e.init(t.data);let r=!1;setInterval(()=>{if(!r&&(r=1==e.generate(),soundsReady+=r,r)){let i=e.createWave().buffer;audioCtx.decodeAudioData(i,e=>{sounds[t.name]=e})}},0)}),started=!0);break;case 2:case 1:break;case GAMEOVER:}},onclick=t=>{onWindowInteraction(t)},ontouchstart=t=>{onWindowInteraction(t)}}();
